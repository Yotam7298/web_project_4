!function(){"use strict";class e{constructor(e,t,s,n,o){this._title=e.name,this._link=e.link,this._likes=e.likes,this._cardId=e._id,this._owner=e.owner,this._selector=t,this._handleCardClick=s,this._handleRemoveElement=n,this._handleLikeClick=o}_getTemplate(){return document.querySelector("#element").content.querySelector(this._selector).cloneNode(!0)}_setEventListeners(){const e=this._element.querySelector(".element__remove-button"),t=this._element.querySelector(".element__image"),s=this._element.querySelector(".element__like-button");this._element.addEventListener("click",(n=>{switch(n.target){case e:this._handleRemoveElement(n);break;case t:this._handleCardClick(n);break;case s:this._handleLikeClick(n)}}))}generateCard(){this._element=this._getTemplate(),this._element._id=this._cardId,this._element.likes=this._likes,this._element.owner=this._owner;const e=this._element.querySelector(".element__image"),t=this._element.querySelector(".element__caption-text"),s=this._element.querySelector(".element__like-counter");return this._setEventListeners(),t.textContent=this._title,e.src=this._link,e.alt="Photo of ".concat(this._title),s.textContent=this._likes.length,this._element}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}resetValidation(){this._toggleButtonState(this._inputList,this._buttonElement),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_showInputError(e,t){const s=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_toggleButtonState(e,t){this._isFormInvalid(e)?(t.classList.add(this._inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._inactiveButtonClass),t.disabled=!1)}_isFormInvalid(e){return e.some((e=>!e.validity.valid))}}class s{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".close-button"),this.close=this.close.bind(this),this._handleClickClose=this._handleClickClose.bind(this),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}setEventListeners(){this._closeButton.addEventListener("click",this.close),this._popup.addEventListener("mousedown",this._handleClickClose),document.addEventListener("keydown",this._handleEscClose)}removeEventListeners(){this._closeButton.removeEventListener("click",this.close),this._popup.removeEventListener("mousedown",this._handleClickClose),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleClickClose(e){e.target===this._popup&&this.close()}}class n extends s{constructor(e,t){var s,n;super(e),n=e=>{const t=this._getInputValues();this._formSubmitHandler(e,t)},(s="_handleSubmit")in this?Object.defineProperty(this,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[s]=n,this._formSubmitHandler=t,this._popupForm=this._popup.querySelector(".form"),this._inputsArray=this._popup.querySelectorAll(".form__input")}_getInputValues(){const e={};return this._inputsArray.forEach((t=>{const s=t.id.split("-");e[s[0]]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._popupForm.removeEventListener("submit",this._handleSubmit)}close(){this._popupForm.reset(),this.removeEventListeners(),super.close()}}const o=document.querySelector(".profile__edit-button"),r={name:document.querySelector("#name-input"),about:document.querySelector("#about-input")},i=document.querySelector(".profile__avatar-edit"),l=document.querySelector(".profile__add-button"),a=document.querySelector(".elements__list"),c=[],h=Array.from(document.querySelectorAll(".form")),u={inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"};function _(){(function(e){const t=document.querySelector(".popup_opened").querySelector(".form").id;return c.find((e=>e.id===t)).validator})().resetValidation()}function d(){m.getAllInfo().then((e=>{const t=e[0],s=e[1];E.renderer(s,t._id)}))}function p(e,t){document.querySelector(t).querySelector(".form__save").textContent=e?"Saving...":"Save"}const m=new class{constructor(e){this._options=e}_verifyResponse(e){return e.ok?e.json():Promise.reject("Something went wrong, Error: ".concat(e.status))}_logInfo(e){console.log("Request was successful:"),console.log(e)}getAllInfo(){return Promise.all([this.getUserInfo(),this.loadCards()]).then((e=>e))}getUserInfo(){return fetch("".concat(this._options.baseUrl,"/users/me"),{headers:this._options.headers}).then((e=>this._verifyResponse(e))).then((e=>e)).catch((e=>console.log(e)))}loadCards(){return fetch("".concat(this._options.baseUrl,"/cards"),{headers:this._options.headers}).then((e=>this._verifyResponse(e))).then((e=>e)).catch((e=>console.log(e)))}editProfileInfo(e){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((e=>this._verifyResponse(e))).then((e=>e)).catch((e=>console.log(e)))}editProfilePicture(e){return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e.avatar})}).then((e=>this._verifyResponse(e))).then((e=>(this._logInfo(e),e))).catch((e=>console.log(e)))}addNewCard(e){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",headers:this._options.headers,body:JSON.stringify({name:e.title,link:e.link})}).then((e=>this._verifyResponse(e))).then((e=>{this._logInfo(e)})).catch((e=>console.log(e)))}deleteCard(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._options.headers}).then((e=>this._verifyResponse(e))).then((e=>{this._logInfo(e)})).catch((e=>console.log(e)))}changeCardLike(e,t){return fetch("".concat(this._options.baseUrl,"/cards/likes/").concat(e),{method:t,headers:this._options.headers}).then((e=>this._verifyResponse(e))).then((e=>(this._logInfo(e),e))).catch((e=>console.log(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"f800af66-4bca-42fd-8139-117d10b5a510","Content-Type":"application/json"}}),v=new class{constructor(e,t,s){this._userName=document.querySelector(e),this._userAbout=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){const e={};return e.name=this._userName.textContent,e.about=this._userAbout.textContent,e}setUserInfo(e){this._userName.textContent=e.name,this._userAbout.textContent=e.about}setUserAvatar(e){this._userAvatar.src=e}}("#profile-name","#profile-about","#profile-avatar"),f=new class extends s{constructor(e){super(e),this._popupImage=this._popup.querySelector("#popup-image"),this._popupCaption=this._popup.querySelector("#popup-caption")}open(e,t){super.open(),this._setPopupContent(e)}_setPopupContent(e){const t=e.currentTarget.querySelector(".element__image"),s=e.currentTarget.querySelector(".element__caption-text");this._popupImage.src=t.src,this._popupImage.alt="Enlarged ".concat(t.alt),this._popupCaption.textContent=s.textContent}}(".image-popup"),E=new class{constructor(e,t){let{renderer:s,modifier:n}=e;this._renderer=s,this._modifier=n,this._container=document.querySelector(t)}renderer(e,t){e.slice().reverse().forEach((e=>{const s=this._renderer(e);this._modifier(s,t),this.addItem(s)}))}addItem(e){this._container.prepend(e)}}({renderer:t=>new e(t,".elements__list-item",(e=>{f.open(e)}),(e=>{const t=e.currentTarget;g.open(),g.confirmDelete(t)}),(e=>{const t=e.currentTarget,s=e.target,n=t.querySelector(".element__like-counter");m.getUserInfo().then((e=>{t.likes.some((t=>t._id===e._id))?m.changeCardLike(t._id,"DELETE").then((e=>{t.likes=e.likes,n.textContent=e.likes.length,s.classList.remove("element__like-button_active")})):m.changeCardLike(t._id,"PUT").then((e=>{t.likes=e.likes,n.textContent=e.likes.length,s.classList.add("element__like-button_active")}))}))})).generateCard(),modifier:(e,t)=>{const s=e.querySelector(".element__remove-button"),n=e.querySelector(".element__like-button");e.owner._id===t&&s.classList.add("element__remove-button_owner"),e.likes.some((e=>e._id===t))&&n.classList.add("element__like-button_active")}},".elements__list"),C=new n(".edit-popup",((e,t)=>{e.preventDefault(),p(!0,".edit-popup"),m.editProfileInfo(t).then((e=>{v.setUserInfo(e),p(!1,".edit-popup")})),C.close()})),b=new n(".avatar-popup",((e,t)=>{e.preventDefault(),p(!0,".avatar-popup"),m.editProfilePicture(t).then((e=>{v.setUserAvatar(e.avatar),b.close(),p(!1,".avatar-popup")}))})),y=new n(".add-popup",((e,t)=>{e.preventDefault(),p(!0,".add-popup"),m.addNewCard(t).then((()=>{a.innerHTML="",d(),p(!1,".add-popup")})),y.close()})),g=new class extends s{constructor(e,t){super(e),this._confirmHandler=t}confirmDelete(e){this._popup.querySelector(".confirm-button").addEventListener("click",(()=>{this._confirmHandler(e),super.close()}))}}(".delete-popup",(e=>{const t=e._id;m.deleteCard(t).then((()=>{a.innerHTML="",d()}))}));o.addEventListener("click",(()=>{var e;e=v.getUserInfo(),r.name.value=e.name,r.about.value=e.about,C.open(),_()})),i.addEventListener("click",(()=>{b.open(),_()})),l.addEventListener("click",(()=>{y.open(),_()})),h.forEach((e=>{const s=new t(u,e);c.push({validator:s,id:e.id}),s.enableValidation()})),m.getAllInfo().then((e=>{const t=e[0],s=e[1];v.setUserInfo(t),v.setUserAvatar(t.avatar),E.renderer(s,t._id)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BeUt4Q3FHLEVBQWlCMUgsT0FDakIyQixPQUVGTCxFQUFpQm5GLGlCQUFpQixTQUFTLEtBQ3pDeUwsRUFBWTVILE9BQ1oyQixPQUlGSixFQUFjcEYsaUJBQWlCLFNBQVMsS0FDdEMyTCxFQUFhOUgsT0FDYjJCLE9BS0ZELEVBQVV4RCxTQUFTbkIsSUFDakIsTUFBTW9MLEVBQWdCLElBQUl0TCxFQUFjQyxFQUFRQyxHQUVoRDBFLEVBQWUyRyxLQUFLLENBQUVyRyxVQUFXb0csRUFBZXJKLEdBQUkvQixFQUFLK0IsS0FFekRxSixFQUFjOUosc0JBMUxkNkQsRUFBSUMsYUFBYUMsTUFBTS9ILElBQ3JCLE1BQU1nSSxFQUFXaEksRUFBSyxHQUNoQmlJLEVBQVlqSSxFQUFLLEdBRXZCNEssRUFBU08sWUFBWW5ELEdBQ3JCNEMsRUFBU1MsY0FBY3JELEVBQVNvQyxRQUVoQ2xDLEVBQWFDLFNBQVNGLEVBQVdELEVBQVNuSCxRIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvdXRpbHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGRhdGEsXHJcbiAgICBjYXJkU2VsZWN0b3IsXHJcbiAgICBoYW5kbGVDYXJkQ2xpY2ssXHJcbiAgICBoYW5kbGVSZW1vdmVFbGVtZW50LFxyXG4gICAgaGFuZGxlTGlrZUNsaWNrXHJcbiAgKSB7XHJcbiAgICB0aGlzLl90aXRsZSA9IGRhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XHJcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICB0aGlzLl9jYXJkSWQgPSBkYXRhLl9pZDtcclxuICAgIHRoaXMuX293bmVyID0gZGF0YS5vd25lcjtcclxuXHJcbiAgICB0aGlzLl9zZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgIHRoaXMuX2hhbmRsZVJlbW92ZUVsZW1lbnQgPSBoYW5kbGVSZW1vdmVFbGVtZW50O1xyXG4gICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrID0gaGFuZGxlTGlrZUNsaWNrO1xyXG4gIH1cclxuXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNlbGVtZW50XCIpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fc2VsZWN0b3IpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgY29uc3QgcmVtb3ZlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX3JlbW92ZS1idXR0b25cIik7XHJcbiAgICBjb25zdCBlbGVtZW50SW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2xpa2UtYnV0dG9uXCIpO1xyXG5cclxuICAgIHRoaXMuX2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgICAgc3dpdGNoIChldnQudGFyZ2V0KSB7XHJcbiAgICAgICAgY2FzZSByZW1vdmVCdXR0b246XHJcbiAgICAgICAgICB0aGlzLl9oYW5kbGVSZW1vdmVFbGVtZW50KGV2dCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIGVsZW1lbnRJbWFnZTpcclxuICAgICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayhldnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBsaWtlQnV0dG9uOlxyXG4gICAgICAgICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrKGV2dCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHJcbiAgICB0aGlzLl9lbGVtZW50Ll9pZCA9IHRoaXMuX2NhcmRJZDtcclxuICAgIHRoaXMuX2VsZW1lbnQubGlrZXMgPSB0aGlzLl9saWtlcztcclxuICAgIHRoaXMuX2VsZW1lbnQub3duZXIgPSB0aGlzLl9vd25lcjtcclxuXHJcbiAgICBjb25zdCBlbGVtZW50SW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBlbGVtZW50Q2FwdGlvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIuZWxlbWVudF9fY2FwdGlvbi10ZXh0XCJcclxuICAgICk7XHJcbiAgICBjb25zdCBlbGVtZW50TGlrZXMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZS1jb3VudGVyXCIpO1xyXG5cclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gICAgZWxlbWVudENhcHRpb24udGV4dENvbnRlbnQgPSB0aGlzLl90aXRsZTtcclxuICAgIGVsZW1lbnRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgZWxlbWVudEltYWdlLmFsdCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICBlbGVtZW50TGlrZXMudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgZm9ybSkge1xyXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IGNvbmZpZy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBjb25maWcuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IGNvbmZpZy5lcnJvckNsYXNzO1xyXG5cclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXHJcbiAgICApO1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRMaXN0LCB0aGlzLl9idXR0b25FbGVtZW50KTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKHRoaXMuX2lucHV0TGlzdCwgdGhpcy5fYnV0dG9uRWxlbWVudCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKGlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG5cclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuXHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSB7XHJcbiAgICBpZiAodGhpcy5faXNGb3JtSW52YWxpZChpbnB1dExpc3QpKSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pc0Zvcm1JbnZhbGlkKGlucHV0TGlzdCkge1xyXG4gICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Nsb3NlQnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5jbG9zZS1idXR0b25cIik7XHJcblxyXG4gICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2UgPSB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVDbGlja0Nsb3NlKGV2dCkge1xyXG4gICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX3BvcHVwKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGZvcm1TdWJtaXRIYW5kbGVyKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyID0gZm9ybVN1Ym1pdEhhbmRsZXI7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbiAgICB0aGlzLl9pbnB1dHNBcnJheSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybV9faW5wdXRcIik7XHJcbiAgfVxyXG5cclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dERhdGEgPSB7fTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dHNBcnJheS5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnB1dE5hbWUgPSBpbnB1dC5pZC5zcGxpdChcIi1cIik7XHJcbiAgICAgIGlucHV0RGF0YVtpbnB1dE5hbWVbMF1dID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gaW5wdXREYXRhO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZVN1Ym1pdCA9IChldnQpID0+IHtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0gdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcclxuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyKGV2dCwgaW5wdXRWYWx1ZXMpO1xyXG4gIH07XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcclxuICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIEVkaXRQcm9maWxlIGZvcm0gY29uc3RzXHJcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuXHJcbmNvbnN0IHVzZXJEYXRhSW5wdXQgPSB7XHJcbiAgbmFtZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuYW1lLWlucHV0XCIpLFxyXG4gIGFib3V0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Fib3V0LWlucHV0XCIpLFxyXG59O1xyXG5jb25zdCBlZGl0QXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItZWRpdFwiKTtcclxuXHJcbi8vIEFkZENhcmQgZm9ybSBjb25zdHNcclxuY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuY29uc3QgZWxlbWVudFNlbGVjdG9yID0gXCIuZWxlbWVudHNfX2xpc3QtaXRlbVwiO1xyXG5jb25zdCBlbGVtZW50c0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2xpc3RcIik7XHJcblxyXG4vLyBWYWxpZGF0b3IgY29uc3RzXHJcbmNvbnN0IHZhbGlkYXRvcnNMaXN0ID0gW107XHJcbmNvbnN0IGZvcm1zTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtXCIpKTtcclxuXHJcbi8vIEluaXRpYWwgZnVuY3Rpb24gY29uc3RzXHJcbmNvbnN0IGNvbmZpZyA9IHtcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5mb3JtX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5mb3JtX19zYXZlXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJmb3JtX19zYXZlX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcImZvcm1fX2lucHV0X2ludmFsaWRcIixcclxuICBlcnJvckNsYXNzOiBcImZvcm1fX2lucHV0LWVycm9yX2FjdGl2ZVwiLFxyXG59O1xyXG5cclxuZXhwb3J0IHtcclxuICBlZGl0UHJvZmlsZUJ1dHRvbixcclxuICBlZGl0QXZhdGFyQnV0dG9uLFxyXG4gIHVzZXJEYXRhSW5wdXQsXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgZWxlbWVudHNDb250YWluZXIsXHJcbiAgdmFsaWRhdG9yc0xpc3QsXHJcbiAgZm9ybXNMaXN0LFxyXG4gIGNvbmZpZyxcclxufTtcclxuIiwiaW1wb3J0IHsgdmFsaWRhdG9yc0xpc3QgfSBmcm9tIFwiLi9jb25zdGFudHMuanNcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtVmFsaWRhdG9yKGZvcm1Db250YWluZXIpIHtcclxuICBjb25zdCBmb3JtSWQgPSBmb3JtQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKS5pZDtcclxuICByZXR1cm4gdmFsaWRhdG9yc0xpc3QuZmluZCgodmFsaWQpID0+IHZhbGlkLmlkID09PSBmb3JtSWQpLnZhbGlkYXRvcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0VmFsaWRhdG9yKCkge1xyXG4gIGNvbnN0IG9wZW5lZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XHJcbiAgY29uc3QgY3VycmVudFZhbGlkYXRvciA9IGdldEZvcm1WYWxpZGF0b3Iob3BlbmVkUG9wdXApO1xyXG4gIGN1cnJlbnRWYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbn1cclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuXHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3NjcmlwdC9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IHtcclxuICBlZGl0UHJvZmlsZUJ1dHRvbixcclxuICBlZGl0QXZhdGFyQnV0dG9uLFxyXG4gIGFkZENhcmRCdXR0b24sXHJcbiAgdXNlckRhdGFJbnB1dCxcclxuICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgZWxlbWVudHNDb250YWluZXIsXHJcbiAgdmFsaWRhdG9yc0xpc3QsXHJcbiAgZm9ybXNMaXN0LFxyXG4gIGNvbmZpZyxcclxufSBmcm9tIFwiLi4vc2NyaXB0L3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgeyByZXNldFZhbGlkYXRvciB9IGZyb20gXCIuLi9zY3JpcHQvdXRpbHMvdXRpbHMuanNcIjtcclxuXHJcbmZ1bmN0aW9uIGZpbGxQcm9maWxlRm9ybShjdXJyZW50SW5mbykge1xyXG4gIHVzZXJEYXRhSW5wdXQubmFtZS52YWx1ZSA9IGN1cnJlbnRJbmZvLm5hbWU7XHJcbiAgdXNlckRhdGFJbnB1dC5hYm91dC52YWx1ZSA9IGN1cnJlbnRJbmZvLmFib3V0O1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW5kZXJJbml0aWFsSW5mbygpIHtcclxuICBhcGkuZ2V0QWxsSW5mbygpLnRoZW4oKGRhdGEpID0+IHtcclxuICAgIGNvbnN0IHVzZXJEYXRhID0gZGF0YVswXTtcclxuICAgIGNvbnN0IGNhcmRzRGF0YSA9IGRhdGFbMV07XHJcblxyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlckRhdGEpO1xyXG4gICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih1c2VyRGF0YS5hdmF0YXIpO1xyXG5cclxuICAgIGNhcmRzU2VjdGlvbi5yZW5kZXJlcihjYXJkc0RhdGEsIHVzZXJEYXRhLl9pZCk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlckNhcmRzKCkge1xyXG4gIGFwaS5nZXRBbGxJbmZvKCkudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgY29uc3QgdXNlckRhdGEgPSBkYXRhWzBdO1xyXG4gICAgY29uc3QgY2FyZHNEYXRhID0gZGF0YVsxXTtcclxuXHJcbiAgICBjYXJkc1NlY3Rpb24ucmVuZGVyZXIoY2FyZHNEYXRhLCB1c2VyRGF0YS5faWQpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVTYXZlQnV0dG9uKGlzU2F2aW5nLCBmb3JtU2VsZWN0b3IpIHtcclxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtU2VsZWN0b3IpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGZvcm0ucXVlcnlTZWxlY3RvcihcIi5mb3JtX19zYXZlXCIpO1xyXG4gIGlmIChpc1NhdmluZykge1xyXG4gICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuICB9IGVsc2Uge1xyXG4gICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgfVxyXG59XHJcblxyXG4vL0NsYXNzZXMgaW5zdGFuY2VzXHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW5cIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImY4MDBhZjY2LTRiY2EtNDJmZC04MTM5LTExN2QxMGI1YTUxMFwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhcclxuICBcIiNwcm9maWxlLW5hbWVcIixcclxuICBcIiNwcm9maWxlLWFib3V0XCIsXHJcbiAgXCIjcHJvZmlsZS1hdmF0YXJcIlxyXG4pO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5pbWFnZS1wb3B1cFwiKTtcclxuXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoaXRlbSkgPT4ge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGl0ZW0sXHJcbiAgICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgICAoZXZ0KSA9PiB7XHJcbiAgICAgIGltYWdlUG9wdXAub3BlbihldnQpO1xyXG4gICAgfSxcclxuICAgIChldnQpID0+IHtcclxuICAgICAgY29uc3QgY2FyZCA9IGV2dC5jdXJyZW50VGFyZ2V0O1xyXG4gICAgICBkZWxldGVQb3B1cC5vcGVuKCk7XHJcbiAgICAgIGRlbGV0ZVBvcHVwLmNvbmZpcm1EZWxldGUoY2FyZCk7XHJcbiAgICB9LFxyXG4gICAgKGV2dCkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkID0gZXZ0LmN1cnJlbnRUYXJnZXQ7XHJcbiAgICAgIGNvbnN0IGxpa2VCdXR0b24gPSBldnQudGFyZ2V0O1xyXG4gICAgICBjb25zdCBsaWtlQ291bnRlciA9IGNhcmQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlLWNvdW50ZXJcIik7XHJcblxyXG4gICAgICBhcGkuZ2V0VXNlckluZm8oKS50aGVuKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgaWYgKGNhcmQubGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT09IHVzZXIuX2lkKSkge1xyXG4gICAgICAgICAgYXBpLmNoYW5nZUNhcmRMaWtlKGNhcmQuX2lkLCBcIkRFTEVURVwiKS50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xyXG4gICAgICAgICAgICBjYXJkLmxpa2VzID0gdXBkYXRlZENhcmQubGlrZXM7XHJcbiAgICAgICAgICAgIGxpa2VDb3VudGVyLnRleHRDb250ZW50ID0gdXBkYXRlZENhcmQubGlrZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYXBpLmNoYW5nZUNhcmRMaWtlKGNhcmQuX2lkLCBcIlBVVFwiKS50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xyXG4gICAgICAgICAgICBjYXJkLmxpa2VzID0gdXBkYXRlZENhcmQubGlrZXM7XHJcbiAgICAgICAgICAgIGxpa2VDb3VudGVyLnRleHRDb250ZW50ID0gdXBkYXRlZENhcmQubGlrZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGdlbmVyYXRlZENhcmQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG4gIHJldHVybiBnZW5lcmF0ZWRDYXJkO1xyXG59O1xyXG5cclxuY29uc3QgY2FyZHNTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAge1xyXG4gICAgcmVuZGVyZXI6IGNyZWF0ZUNhcmQsXHJcbiAgICBtb2RpZmllcjogKGVsZW1lbnQsIHVzZXJJZCkgPT4ge1xyXG4gICAgICBjb25zdCBlbGVtZW50UmVtb3ZlQnV0dG9uID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIFwiLmVsZW1lbnRfX3JlbW92ZS1idXR0b25cIlxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCBlbGVtZW50TGlrZUJ1dHRvbiA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlLWJ1dHRvblwiKTtcclxuXHJcbiAgICAgIGlmIChlbGVtZW50Lm93bmVyLl9pZCA9PT0gdXNlcklkKSB7XHJcbiAgICAgICAgZWxlbWVudFJlbW92ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZWxlbWVudF9fcmVtb3ZlLWJ1dHRvbl9vd25lclwiKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZWxlbWVudC5saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdXNlcklkKSkge1xyXG4gICAgICAgIGVsZW1lbnRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgfSxcclxuICBcIi5lbGVtZW50c19fbGlzdFwiXHJcbik7XHJcblxyXG5jb25zdCBlZGl0UHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIuZWRpdC1wb3B1cFwiLFxyXG4gIChldnQsIGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIHVwZGF0ZVNhdmVCdXR0b24odHJ1ZSwgXCIuZWRpdC1wb3B1cFwiKTtcclxuXHJcbiAgICBhcGkuZWRpdFByb2ZpbGVJbmZvKGlucHV0VmFsdWVzKS50aGVuKCh1c2VyUGFyYW1ldGVycykgPT4ge1xyXG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyUGFyYW1ldGVycyk7XHJcblxyXG4gICAgICB1cGRhdGVTYXZlQnV0dG9uKGZhbHNlLCBcIi5lZGl0LXBvcHVwXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZWRpdFByb2ZpbGVQb3B1cC5jbG9zZSgpO1xyXG4gIH1cclxuKTtcclxuXHJcbmNvbnN0IGF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIuYXZhdGFyLXBvcHVwXCIsIChldnQsIGlucHV0VmFsdWUpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgdXBkYXRlU2F2ZUJ1dHRvbih0cnVlLCBcIi5hdmF0YXItcG9wdXBcIik7XHJcblxyXG4gIGFwaS5lZGl0UHJvZmlsZVBpY3R1cmUoaW5wdXRWYWx1ZSkudGhlbigodXNlclBhcmFtZXRlcnMpID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlclBhcmFtZXRlcnMuYXZhdGFyKTtcclxuICAgIGF2YXRhclBvcHVwLmNsb3NlKCk7XHJcblxyXG4gICAgdXBkYXRlU2F2ZUJ1dHRvbihmYWxzZSwgXCIuYXZhdGFyLXBvcHVwXCIpO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbmNvbnN0IGFkZENhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLmFkZC1wb3B1cFwiLCAoZXZ0LCBpbnB1dFZhbHVlcykgPT4ge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICB1cGRhdGVTYXZlQnV0dG9uKHRydWUsIFwiLmFkZC1wb3B1cFwiKTtcclxuXHJcbiAgYXBpLmFkZE5ld0NhcmQoaW5wdXRWYWx1ZXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgZWxlbWVudHNDb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIHJlbmRlckNhcmRzKCk7XHJcblxyXG4gICAgdXBkYXRlU2F2ZUJ1dHRvbihmYWxzZSwgXCIuYWRkLXBvcHVwXCIpO1xyXG4gIH0pO1xyXG5cclxuICBhZGRDYXJkUG9wdXAuY2xvc2UoKTtcclxufSk7XHJcblxyXG5jb25zdCBkZWxldGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtKFwiLmRlbGV0ZS1wb3B1cFwiLCAoaXRlbSkgPT4ge1xyXG4gIGNvbnN0IGNhcmRJZCA9IGl0ZW0uX2lkO1xyXG4gIGFwaS5kZWxldGVDYXJkKGNhcmRJZCkudGhlbigoKSA9PiB7XHJcbiAgICBlbGVtZW50c0NvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgcmVuZGVyQ2FyZHMoKTtcclxuICB9KTtcclxufSk7XHJcblxyXG4vLyBFVkVOVCBMSVNURU5FUlNcclxuLy8gRWRpdCBQcm9maWxlIGZvcm0gbGlzdGVuZXJzXHJcbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgdXNlckN1cnJlbnRJbmZvID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBmaWxsUHJvZmlsZUZvcm0odXNlckN1cnJlbnRJbmZvKTtcclxuXHJcbiAgZWRpdFByb2ZpbGVQb3B1cC5vcGVuKCk7XHJcbiAgcmVzZXRWYWxpZGF0b3IoKTtcclxufSk7XHJcbmVkaXRBdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhdmF0YXJQb3B1cC5vcGVuKCk7XHJcbiAgcmVzZXRWYWxpZGF0b3IoKTtcclxufSk7XHJcblxyXG4vLyBBZGQgQ2FyZCBmb3JtIGxpc3RlbmVyc1xyXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgYWRkQ2FyZFBvcHVwLm9wZW4oKTtcclxuICByZXNldFZhbGlkYXRvcigpO1xyXG59KTtcclxuXHJcbi8vIEluaXRpYWwgZnVuY3Rpb25zXHJcblxyXG5mb3Jtc0xpc3QuZm9yRWFjaCgoZm9ybSkgPT4ge1xyXG4gIGNvbnN0IGZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIGZvcm0pO1xyXG5cclxuICB2YWxpZGF0b3JzTGlzdC5wdXNoKHsgdmFsaWRhdG9yOiBmb3JtVmFsaWRhdG9yLCBpZDogZm9ybS5pZCB9KTtcclxuXHJcbiAgZm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbn0pO1xyXG5cclxuLy8gcmVuZGVyVXNlckluZm8oKTtcclxuLy8gcmVuZGVyQ2FyZHMoKTtcclxuLy8gYXBpLmdldEFsbEluZm8oKTtcclxuXHJcbnJlbmRlckluaXRpYWxJbmZvKCk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgfVxyXG5cclxuICBfdmVyaWZ5UmVzcG9uc2UocmVzKSB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBTb21ldGhpbmcgd2VudCB3cm9uZywgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcblxyXG4gIF9sb2dJbmZvKHJlcykge1xyXG4gICAgY29uc29sZS5sb2coXCJSZXF1ZXN0IHdhcyBzdWNjZXNzZnVsOlwiKTtcclxuICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgfVxyXG5cclxuICBnZXRBbGxJbmZvKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMubG9hZENhcmRzKCldKS50aGVuKFxyXG4gICAgICAodmFsdWVzKSA9PiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJVc2VyIERhdGE6XCIpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbHVlc1swXSk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJDYXJkcyBEYXRhOlwiKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWx1ZXNbMV0pO1xyXG4gICAgICAgIHJldHVybiB2YWx1ZXM7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcmlmeVJlc3BvbnNlKHJlcyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgfVxyXG5cclxuICBsb2FkQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92ZXJpZnlSZXNwb25zZShyZXMpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gIH1cclxuXHJcbiAgZWRpdFByb2ZpbGVJbmZvKHVzZXJOZXdJbmZvKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IHVzZXJOZXdJbmZvLm5hbWUsXHJcbiAgICAgICAgYWJvdXQ6IHVzZXJOZXdJbmZvLmFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVyaWZ5UmVzcG9uc2UocmVzKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuICB9XHJcblxyXG4gIGVkaXRQcm9maWxlUGljdHVyZShhdmF0YXJVcmwpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogYXZhdGFyVXJsLmF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcmlmeVJlc3BvbnNlKHJlcyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gIH1cclxuXHJcbiAgYWRkTmV3Q2FyZChjYXJkTmV3SW5mbykge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX29wdGlvbnMuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IGNhcmROZXdJbmZvLnRpdGxlLFxyXG4gICAgICAgIGxpbms6IGNhcmROZXdJbmZvLmxpbmssXHJcbiAgICAgIH0pLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92ZXJpZnlSZXNwb25zZShyZXMpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbG9nSW5mbyhyZXMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX29wdGlvbnMuYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVyaWZ5UmVzcG9uc2UocmVzKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlQ2FyZExpa2UoY2FyZElkLCBtZXRob2QpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBtZXRob2QsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVyaWZ5UmVzcG9uc2UocmVzKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih1c2VyTmFtZVNlbGVjdG9yLCB1c2VyQWJvdXRTZWxlY3RvciwgdXNlckF2YXRhclNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl91c2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl91c2VyQWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJBYm91dFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX3VzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJBdmF0YXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIGNvbnN0IHVzZXJJbmZvID0ge307XHJcbiAgICB1c2VySW5mby5uYW1lID0gdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQ7XHJcbiAgICB1c2VySW5mby5hYm91dCA9IHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudDtcclxuICAgIHJldHVybiB1c2VySW5mbztcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKG5ld1VzZXJQYXJhbWV0ZXJzKSB7XHJcbiAgICB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCA9IG5ld1VzZXJQYXJhbWV0ZXJzLm5hbWU7XHJcbiAgICB0aGlzLl91c2VyQWJvdXQudGV4dENvbnRlbnQgPSBuZXdVc2VyUGFyYW1ldGVycy5hYm91dDtcclxuICB9XHJcblxyXG4gIHNldFVzZXJBdmF0YXIobmV3VXNlckF2YXRhcikge1xyXG4gICAgdGhpcy5fdXNlckF2YXRhci5zcmMgPSBuZXdVc2VyQXZhdGFyO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtaW1hZ2VcIik7XHJcbiAgICB0aGlzLl9wb3B1cENhcHRpb24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLWNhcHRpb25cIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKGV2dCwgaXRlbSkge1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gICAgdGhpcy5fc2V0UG9wdXBDb250ZW50KGV2dCk7XHJcbiAgfVxyXG5cclxuICBfc2V0UG9wdXBDb250ZW50KGV2dCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRJbWFnZSA9IGV2dC5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBzZWxlY3RlZENhcHRpb24gPSBldnQuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIi5lbGVtZW50X19jYXB0aW9uLXRleHRcIlxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLl9wb3B1cEltYWdlLnNyYyA9IHNlbGVjdGVkSW1hZ2Uuc3JjO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZS5hbHQgPSBgRW5sYXJnZWQgJHtzZWxlY3RlZEltYWdlLmFsdH1gO1xyXG4gICAgdGhpcy5fcG9wdXBDYXB0aW9uLnRleHRDb250ZW50ID0gc2VsZWN0ZWRDYXB0aW9uLnRleHRDb250ZW50O1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IHJlbmRlcmVyLCBtb2RpZmllciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX21vZGlmaWVyID0gbW9kaWZpZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIHJlbmRlcmVyKGl0ZW1zLCBtb2RzKSB7XHJcbiAgICBpdGVtc1xyXG4gICAgICAuc2xpY2UoKVxyXG4gICAgICAucmV2ZXJzZSgpXHJcbiAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG5cclxuICAgICAgICB0aGlzLl9tb2RpZmllcihlbGVtZW50LCBtb2RzKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRJdGVtKGVsZW1lbnQpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBjb25maXJtSGFuZGxlcikge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9jb25maXJtSGFuZGxlciA9IGNvbmZpcm1IYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgY29uZmlybURlbGV0ZShldnQpIHtcclxuICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmNvbmZpcm0tYnV0dG9uXCIpO1xyXG5cclxuICAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgdGhpcy5fY29uZmlybUhhbmRsZXIoZXZ0KTtcclxuICAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZVJlbW92ZUVsZW1lbnQiLCJoYW5kbGVMaWtlQ2xpY2siLCJ0aGlzIiwiX3RpdGxlIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9saWtlcyIsImxpa2VzIiwiX2NhcmRJZCIsIl9pZCIsIl9vd25lciIsIm93bmVyIiwiX3NlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVSZW1vdmVFbGVtZW50IiwiX2hhbmRsZUxpa2VDbGljayIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVCdXR0b24iLCJfZWxlbWVudCIsImVsZW1lbnRJbWFnZSIsImxpa2VCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwidGFyZ2V0IiwiZ2VuZXJhdGVDYXJkIiwiZWxlbWVudENhcHRpb24iLCJlbGVtZW50TGlrZXMiLCJ0ZXh0Q29udGVudCIsInNyYyIsImFsdCIsImxlbmd0aCIsIkZvcm1WYWxpZGF0b3IiLCJjb25maWciLCJmb3JtIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfYnV0dG9uRWxlbWVudCIsInJlc2V0VmFsaWRhdGlvbiIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImZvckVhY2giLCJpbnB1dCIsIl9oaWRlSW5wdXRFcnJvciIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0RWxlbWVudCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImVycm9yTWVzc2FnZSIsImFkZCIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJfaXNGb3JtSW52YWxpZCIsImRpc2FibGVkIiwic29tZSIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cCIsIl9jbG9zZUJ1dHRvbiIsImNsb3NlIiwiYmluZCIsIl9oYW5kbGVDbGlja0Nsb3NlIiwiX2hhbmRsZUVzY0Nsb3NlIiwib3BlbiIsInNldEV2ZW50TGlzdGVuZXJzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwiUG9wdXBXaXRoRm9ybSIsImZvcm1TdWJtaXRIYW5kbGVyIiwic3VwZXIiLCJpbnB1dFZhbHVlcyIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtU3VibWl0SGFuZGxlciIsIl9wb3B1cEZvcm0iLCJfaW5wdXRzQXJyYXkiLCJpbnB1dERhdGEiLCJpbnB1dE5hbWUiLCJzcGxpdCIsInZhbHVlIiwiX2hhbmRsZVN1Ym1pdCIsInJlc2V0IiwiZWRpdFByb2ZpbGVCdXR0b24iLCJ1c2VyRGF0YUlucHV0IiwiYWJvdXQiLCJlZGl0QXZhdGFyQnV0dG9uIiwiYWRkQ2FyZEJ1dHRvbiIsImVsZW1lbnRzQ29udGFpbmVyIiwidmFsaWRhdG9yc0xpc3QiLCJmb3Jtc0xpc3QiLCJyZXNldFZhbGlkYXRvciIsImZvcm1Db250YWluZXIiLCJmb3JtSWQiLCJmaW5kIiwidmFsaWRhdG9yIiwiZ2V0Rm9ybVZhbGlkYXRvciIsInJlbmRlckNhcmRzIiwiYXBpIiwiZ2V0QWxsSW5mbyIsInRoZW4iLCJ1c2VyRGF0YSIsImNhcmRzRGF0YSIsImNhcmRzU2VjdGlvbiIsInJlbmRlcmVyIiwidXBkYXRlU2F2ZUJ1dHRvbiIsImlzU2F2aW5nIiwiZm9ybVNlbGVjdG9yIiwib3B0aW9ucyIsIl9vcHRpb25zIiwiX3ZlcmlmeVJlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsIl9sb2dJbmZvIiwiY29uc29sZSIsImxvZyIsImFsbCIsImdldFVzZXJJbmZvIiwibG9hZENhcmRzIiwidmFsdWVzIiwiZmV0Y2giLCJiYXNlVXJsIiwiaGVhZGVycyIsImNhdGNoIiwiZXJyIiwiZWRpdFByb2ZpbGVJbmZvIiwidXNlck5ld0luZm8iLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRQcm9maWxlUGljdHVyZSIsImF2YXRhclVybCIsImF2YXRhciIsImFkZE5ld0NhcmQiLCJjYXJkTmV3SW5mbyIsInRpdGxlIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImNoYW5nZUNhcmRMaWtlIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJBYm91dFNlbGVjdG9yIiwidXNlckF2YXRhclNlbGVjdG9yIiwiX3VzZXJOYW1lIiwiX3VzZXJBYm91dCIsIl91c2VyQXZhdGFyIiwic2V0VXNlckluZm8iLCJuZXdVc2VyUGFyYW1ldGVycyIsInNldFVzZXJBdmF0YXIiLCJuZXdVc2VyQXZhdGFyIiwiaW1hZ2VQb3B1cCIsIl9wb3B1cEltYWdlIiwiX3BvcHVwQ2FwdGlvbiIsIml0ZW0iLCJfc2V0UG9wdXBDb250ZW50Iiwic2VsZWN0ZWRJbWFnZSIsImN1cnJlbnRUYXJnZXQiLCJzZWxlY3RlZENhcHRpb24iLCJjb250YWluZXJTZWxlY3RvciIsIm1vZGlmaWVyIiwiX3JlbmRlcmVyIiwiX21vZGlmaWVyIiwiX2NvbnRhaW5lciIsIml0ZW1zIiwibW9kcyIsInNsaWNlIiwicmV2ZXJzZSIsImVsZW1lbnQiLCJhZGRJdGVtIiwicHJlcGVuZCIsImNhcmQiLCJkZWxldGVQb3B1cCIsImNvbmZpcm1EZWxldGUiLCJsaWtlQ291bnRlciIsInVzZXIiLCJsaWtlIiwidXBkYXRlZENhcmQiLCJ1c2VySWQiLCJlbGVtZW50UmVtb3ZlQnV0dG9uIiwiZWxlbWVudExpa2VCdXR0b24iLCJlZGl0UHJvZmlsZVBvcHVwIiwidXNlclBhcmFtZXRlcnMiLCJhdmF0YXJQb3B1cCIsImlucHV0VmFsdWUiLCJhZGRDYXJkUG9wdXAiLCJpbm5lckhUTUwiLCJjb25maXJtSGFuZGxlciIsIl9jb25maXJtSGFuZGxlciIsImN1cnJlbnRJbmZvIiwiZm9ybVZhbGlkYXRvciIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9