!function(){"use strict";class e{constructor(e,t,s,r,n,o){this._title=e.name,this._link=e.link,this._cardId=e._id,this._likes=e.likes,this._owner=e.owner,this._userId=s,this._selector=t,this._handleCardClick=r,this._handleRemoveElement=n,this._handleLikeClick=o}_getTemplate(){return document.querySelector("#element").content.querySelector(this._selector).cloneNode(!0)}_setEventListeners(){const e=this._element.querySelector(".element__remove-button"),t=this._element.querySelector(".element__image"),s=this._element.querySelector(".element__like-button");this._element.addEventListener("click",(r=>{switch(r.target){case e:this._handleRemoveElement(r);break;case t:this._handleCardClick(r);break;case s:this._handleLikeClick(r)}}))}isLiked(){return this._likes.some((e=>e._id===this._userId))}_renderLikes(){const e=this._element.querySelector(".element__like-counter"),t=this._element.querySelector(".element__like-button");e.textContent=this._likes.length,this.isLiked()?t.classList.add("element__like-button_active"):t.classList.remove("element__like-button_active")}_renderDeleteButton(){const e=this._element.querySelector(".element__remove-button");this._owner._id===this._userId&&e.classList.add("element__remove-button_owner")}updateLikes(e){this._likes=e,this._renderLikes()}generateCard(){this._element=this._getTemplate(),this._element._id=this._cardId,this._element.owner=this._owner;const e=this._element.querySelector(".element__image"),t=this._element.querySelector(".element__caption-text"),s=this._element.querySelector(".element__like-counter");return this._setEventListeners(),this._renderLikes(),this._renderDeleteButton(),t.textContent=this._title,e.src=this._link,e.alt="Photo of ".concat(this._title),s.textContent=this._likes.length,this._element}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}resetValidation(){this._toggleButtonState(this._inputList,this._buttonElement),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_showInputError(e,t){const s=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_toggleButtonState(e,t){this._isFormInvalid(e)?(t.classList.add(this._inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._inactiveButtonClass),t.disabled=!1)}_isFormInvalid(e){return e.some((e=>!e.validity.valid))}}class s{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".close-button"),this.close=this.close.bind(this),this._handleClickClose=this._handleClickClose.bind(this),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}setEventListeners(){this._closeButton.addEventListener("click",this.close),this._popup.addEventListener("mousedown",this._handleClickClose),document.addEventListener("keydown",this._handleEscClose)}removeEventListeners(){this._closeButton.removeEventListener("click",this.close),this._popup.removeEventListener("mousedown",this._handleClickClose),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleClickClose(e){e.target===this._popup&&this.close()}}class r extends s{constructor(e,t){var s,r;super(e),r=e=>{const t=this._getInputValues();this._formSubmitHandler(e,t)},(s="_handleSubmit")in this?Object.defineProperty(this,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[s]=r,this._formSubmitHandler=t,this._popupForm=this._popup.querySelector(".form"),this._inputsArray=this._popup.querySelectorAll(".form__input")}_getInputValues(){const e={};return this._inputsArray.forEach((t=>{const s=t.id.split("-");e[s[0]]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._popupForm.removeEventListener("submit",this._handleSubmit)}close(){this._popupForm.reset(),this.removeEventListeners(),super.close()}}const n=document.querySelector(".profile__edit-button"),o={name:document.querySelector("#name-input"),about:document.querySelector("#about-input")},i=document.querySelector(".profile__avatar-edit"),a=document.querySelector(".profile__add-button"),l=(document.querySelector(".elements__list"),[]),c=Array.from(document.querySelectorAll(".form")),h={inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"};function u(){(function(e){const t=document.querySelector(".popup_opened").querySelector(".form").id;return l.find((e=>e.id===t)).validator})().resetValidation()}function _(e,t){const s=document.querySelector(t).querySelector(".submit-button");e?s.textContent="Saving...":(t=".delete-popup")?s.textContent="Yes":s.textContent="Save"}const d=new class{constructor(e){this._options=e}_verifyResponse(e){return e.ok?e.json():Promise.reject(err)}reportError(e){console.log("Something went wrong, Error: ".concat(e.status))}_logInfo(e){console.log("Request was successful:"),console.log(e)}getAllInfo(){return Promise.all([this.getUserInfo(),this.loadCards()]).then((e=>e))}getUserInfo(){return fetch("".concat(this._options.baseUrl,"/users/me"),{headers:this._options.headers}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}loadCards(){return fetch("".concat(this._options.baseUrl,"/cards"),{headers:this._options.headers}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}editProfileInfo(e){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}editProfilePicture(e){return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e.avatar})}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}addNewCard(e){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",headers:this._options.headers,body:JSON.stringify({name:e.title,link:e.link})}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}deleteCard(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._options.headers}).then(this._verifyResponse).then((e=>{this._logInfo(e)}))}changeCardLike(e,t){return fetch("".concat(this._options.baseUrl,"/cards/likes/").concat(e),{method:t,headers:this._options.headers}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"f800af66-4bca-42fd-8139-117d10b5a510","Content-Type":"application/json"}}),p=new class{constructor(e,t,s){this._userName=document.querySelector(e),this._userAbout=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){const e={};return e.name=this._userName.textContent,e.about=this._userAbout.textContent,e}saveUserId(e){this._userId=e}getUserId(){return this._userId}setUserInfo(e){this._userName.textContent=e.name,this._userAbout.textContent=e.about}setUserAvatar(e){this._userAvatar.src=e}}("#profile-name","#profile-about","#profile-avatar"),m=new class extends s{constructor(e){super(e),this._popupImage=this._popup.querySelector("#popup-image"),this._popupCaption=this._popup.querySelector("#popup-caption")}open(e,t){super.open(),this._setPopupContent(e)}_setPopupContent(e){const t=e.currentTarget.querySelector(".element__image"),s=e.currentTarget.querySelector(".element__caption-text");this._popupImage.src=t.src,this._popupImage.alt="Enlarged ".concat(t.alt),this._popupCaption.textContent=s.textContent}}(".image-popup"),v=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderer(e){const t=this._renderer(e);this.addItem(t)}addItem(e){this._container.prepend(e)}}({renderer:t=>{const s=new e(t,".elements__list-item",p.getUserId(),(e=>{m.open(e)}),(e=>{const t=e.currentTarget;y.open(),y.setConfirmHandler((()=>{const e=s._cardId;_(!0,".delete-popup"),d.deleteCard(e).then((()=>{t.remove(),y.close()})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".delete-popup")}))})),y.setEventListeners()}),(()=>{s.isLiked()?d.changeCardLike(s._cardId,"DELETE").then((e=>{s.updateLikes(e.likes)})).catch((e=>d.reportError(e))):d.changeCardLike(s._cardId,"PUT").then((e=>{s.updateLikes(e.likes)})).catch((e=>d.reportError(e)))}));return s.generateCard()}},".elements__list"),f=new r(".edit-popup",((e,t)=>{e.preventDefault(),_(!0,".edit-popup"),d.editProfileInfo(t).then((e=>{p.setUserInfo(e)})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".edit-popup")})),f.close()})),E=new r(".avatar-popup",((e,t)=>{e.preventDefault(),_(!0,".avatar-popup"),d.editProfilePicture(t).then((e=>{p.setUserAvatar(e.avatar),E.close()})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".avatar-popup")}))})),C=new r(".add-popup",((e,t)=>{e.preventDefault(),_(!0,".add-popup"),d.addNewCard(t).then((e=>{v.renderer(e,p.getUserId())})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".add-popup")})),C.close()})),y=new class extends s{constructor(e,t){super(e),this._confirmButton=this._popup.querySelector(".submit-button")}setConfirmHandler(e){this._handleConfirm=e}setEventListeners(){super.setEventListeners(),this._confirmButton.addEventListener("click",this._handleConfirm)}removeEventListeners(){super.removeEventListeners(),this._confirmButton.removeEventListener("click",this._handleConfirm)}}(".delete-popup");n.addEventListener("click",(()=>{var e;e=p.getUserInfo(),o.name.value=e.name,o.about.value=e.about,f.open(),u()})),i.addEventListener("click",(()=>{E.open(),u()})),a.addEventListener("click",(()=>{C.open(),u()})),c.forEach((e=>{const s=new t(h,e);l.push({validator:s,id:e.id}),s.enableValidation()})),d.getAllInfo().then((e=>{const t=e[0],s=e[1];p.saveUserId(t._id),p.setUserInfo(t),p.setUserAvatar(t.avatar),s.slice().reverse().forEach((e=>{v.renderer(e,t._id)}))})).catch((e=>d.reportError(e)))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQVF5RyxFQUFZcE4sS0FDdkMrRyxFQUFjQyxNQUFNTCxNQUFReUcsRUFBWXBHLE1Bb0t4QzJGLEVBQWlCaEgsT0FDakIwQixPQUVGSixFQUFpQnpGLGlCQUFpQixTQUFTLEtBQ3pDcUwsRUFBWWxILE9BQ1owQixPQUlGSCxFQUFjMUYsaUJBQWlCLFNBQVMsS0FDdEN1TCxFQUFhcEgsT0FDYjBCLE9BS0ZELEVBQVVuRCxTQUFTbkIsSUFDakIsTUFBTXVLLEVBQWdCLElBQUl6SyxFQUFjQyxFQUFRQyxHQUVoRHFFLEVBQWVtRyxLQUFLLENBQUU3RixVQUFXNEYsRUFBZXhJLEdBQUkvQixFQUFLK0IsS0FFekR3SSxFQUFjakosc0JBckxkMkQsRUFDR2UsYUFDQUksTUFBTTFKLElBQ0wsTUFBTStOLEVBQVcvTixFQUFLLEdBQ2hCZ08sRUFBWWhPLEVBQUssR0FFdkIrSyxFQUFTTyxXQUFXeUMsRUFBU25OLEtBQzdCbUssRUFBU1MsWUFBWXVDLEdBQ3JCaEQsRUFBU1csY0FBY3FDLEVBQVN4RCxRQUVoQ3lELEVBQ0dDLFFBQ0FDLFVBQ0F6SixTQUFTbUksSUFDUlIsRUFBYUUsU0FBU00sRUFBTW1CLEVBQVNuTixXQUcxQ29NLE9BQU9oRSxHQUFRVCxFQUFJVSxZQUFZRCxLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvdXRpbHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBkYXRhLFxyXG4gICAgY2FyZFNlbGVjdG9yLFxyXG4gICAgdXNlcklkLFxyXG4gICAgaGFuZGxlQ2FyZENsaWNrLFxyXG4gICAgaGFuZGxlUmVtb3ZlRWxlbWVudCxcclxuICAgIGhhbmRsZUxpa2VDbGlja1xyXG4gICkge1xyXG4gICAgdGhpcy5fdGl0bGUgPSBkYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xyXG4gICAgdGhpcy5fY2FyZElkID0gZGF0YS5faWQ7XHJcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICB0aGlzLl9vd25lciA9IGRhdGEub3duZXI7XHJcblxyXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG5cclxuICAgIHRoaXMuX3NlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5faGFuZGxlUmVtb3ZlRWxlbWVudCA9IGhhbmRsZVJlbW92ZUVsZW1lbnQ7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sgPSBoYW5kbGVMaWtlQ2xpY2s7XHJcbiAgfVxyXG5cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNlbGVtZW50XCIpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fc2VsZWN0b3IpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRUZW1wbGF0ZTtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIGNvbnN0IHJlbW92ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19yZW1vdmUtYnV0dG9uXCIpO1xyXG4gICAgY29uc3QgZWxlbWVudEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2ltYWdlXCIpO1xyXG4gICAgY29uc3QgbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlLWJ1dHRvblwiKTtcclxuXHJcbiAgICB0aGlzLl9lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIHN3aXRjaCAoZXZ0LnRhcmdldCkge1xyXG4gICAgICAgIGNhc2UgcmVtb3ZlQnV0dG9uOlxyXG4gICAgICAgICAgdGhpcy5faGFuZGxlUmVtb3ZlRWxlbWVudChldnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBlbGVtZW50SW1hZ2U6XHJcbiAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soZXZ0KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgbGlrZUJ1dHRvbjpcclxuICAgICAgICAgIHRoaXMuX2hhbmRsZUxpa2VDbGljayhldnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaXNMaWtlZCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fdXNlcklkKTtcclxuICB9XHJcblxyXG4gIF9yZW5kZXJMaWtlcygpIHtcclxuICAgIGNvbnN0IGxpa2VDb3VudGVyID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2xpa2UtY291bnRlclwiKTtcclxuICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZS1idXR0b25cIik7XHJcblxyXG4gICAgbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcbiAgICBpZiAodGhpcy5pc0xpa2VkKCkpIHtcclxuICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3JlbmRlckRlbGV0ZUJ1dHRvbigpIHtcclxuICAgIGNvbnN0IHJlbW92ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19yZW1vdmUtYnV0dG9uXCIpO1xyXG5cclxuICAgIGlmICh0aGlzLl9vd25lci5faWQgPT09IHRoaXMuX3VzZXJJZCkge1xyXG4gICAgICByZW1vdmVCdXR0b24uY2xhc3NMaXN0LmFkZChcImVsZW1lbnRfX3JlbW92ZS1idXR0b25fb3duZXJcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGVMaWtlcyhsaWtlcykge1xyXG4gICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHJcbiAgICB0aGlzLl9lbGVtZW50Ll9pZCA9IHRoaXMuX2NhcmRJZDtcclxuICAgIHRoaXMuX2VsZW1lbnQub3duZXIgPSB0aGlzLl9vd25lcjtcclxuXHJcbiAgICBjb25zdCBlbGVtZW50SW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBlbGVtZW50Q2FwdGlvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIuZWxlbWVudF9fY2FwdGlvbi10ZXh0XCJcclxuICAgICk7XHJcbiAgICBjb25zdCBlbGVtZW50TGlrZXMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZS1jb3VudGVyXCIpO1xyXG5cclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xyXG4gICAgdGhpcy5fcmVuZGVyRGVsZXRlQnV0dG9uKCk7XHJcblxyXG4gICAgZWxlbWVudENhcHRpb24udGV4dENvbnRlbnQgPSB0aGlzLl90aXRsZTtcclxuICAgIGVsZW1lbnRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgZWxlbWVudEltYWdlLmFsdCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICBlbGVtZW50TGlrZXMudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgZm9ybSkge1xyXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IGNvbmZpZy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBjb25maWcuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IGNvbmZpZy5lcnJvckNsYXNzO1xyXG5cclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXHJcbiAgICApO1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRMaXN0LCB0aGlzLl9idXR0b25FbGVtZW50KTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKHRoaXMuX2lucHV0TGlzdCwgdGhpcy5fYnV0dG9uRWxlbWVudCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKGlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG5cclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuXHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSB7XHJcbiAgICBpZiAodGhpcy5faXNGb3JtSW52YWxpZChpbnB1dExpc3QpKSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pc0Zvcm1JbnZhbGlkKGlucHV0TGlzdCkge1xyXG4gICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Nsb3NlQnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5jbG9zZS1idXR0b25cIik7XHJcblxyXG4gICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2UgPSB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVDbGlja0Nsb3NlKGV2dCkge1xyXG4gICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX3BvcHVwKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGZvcm1TdWJtaXRIYW5kbGVyKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyID0gZm9ybVN1Ym1pdEhhbmRsZXI7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbiAgICB0aGlzLl9pbnB1dHNBcnJheSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybV9faW5wdXRcIik7XHJcbiAgfVxyXG5cclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dERhdGEgPSB7fTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dHNBcnJheS5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnB1dE5hbWUgPSBpbnB1dC5pZC5zcGxpdChcIi1cIik7XHJcbiAgICAgIGlucHV0RGF0YVtpbnB1dE5hbWVbMF1dID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gaW5wdXREYXRhO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZVN1Ym1pdCA9IChldnQpID0+IHtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0gdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcclxuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyKGV2dCwgaW5wdXRWYWx1ZXMpO1xyXG4gIH07XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcclxuICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIEVkaXRQcm9maWxlIGZvcm0gY29uc3RzXHJcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuXHJcbmNvbnN0IHVzZXJEYXRhSW5wdXQgPSB7XHJcbiAgbmFtZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuYW1lLWlucHV0XCIpLFxyXG4gIGFib3V0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Fib3V0LWlucHV0XCIpLFxyXG59O1xyXG5jb25zdCBlZGl0QXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItZWRpdFwiKTtcclxuXHJcbi8vIEFkZENhcmQgZm9ybSBjb25zdHNcclxuY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuY29uc3QgZWxlbWVudFNlbGVjdG9yID0gXCIuZWxlbWVudHNfX2xpc3QtaXRlbVwiO1xyXG5jb25zdCBlbGVtZW50c0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2xpc3RcIik7XHJcblxyXG4vLyBWYWxpZGF0b3IgY29uc3RzXHJcbmNvbnN0IHZhbGlkYXRvcnNMaXN0ID0gW107XHJcbmNvbnN0IGZvcm1zTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtXCIpKTtcclxuXHJcbi8vIEluaXRpYWwgZnVuY3Rpb24gY29uc3RzXHJcbmNvbnN0IGNvbmZpZyA9IHtcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5mb3JtX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5mb3JtX19zYXZlXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJmb3JtX19zYXZlX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcImZvcm1fX2lucHV0X2ludmFsaWRcIixcclxuICBlcnJvckNsYXNzOiBcImZvcm1fX2lucHV0LWVycm9yX2FjdGl2ZVwiLFxyXG59O1xyXG5cclxuZXhwb3J0IHtcclxuICBlZGl0UHJvZmlsZUJ1dHRvbixcclxuICBlZGl0QXZhdGFyQnV0dG9uLFxyXG4gIHVzZXJEYXRhSW5wdXQsXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgZWxlbWVudHNDb250YWluZXIsXHJcbiAgdmFsaWRhdG9yc0xpc3QsXHJcbiAgZm9ybXNMaXN0LFxyXG4gIGNvbmZpZyxcclxufTtcclxuIiwiaW1wb3J0IHsgdmFsaWRhdG9yc0xpc3QgfSBmcm9tIFwiLi9jb25zdGFudHMuanNcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtVmFsaWRhdG9yKGZvcm1Db250YWluZXIpIHtcclxuICBjb25zdCBmb3JtSWQgPSBmb3JtQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKS5pZDtcclxuICByZXR1cm4gdmFsaWRhdG9yc0xpc3QuZmluZCgodmFsaWQpID0+IHZhbGlkLmlkID09PSBmb3JtSWQpLnZhbGlkYXRvcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0VmFsaWRhdG9yKCkge1xyXG4gIGNvbnN0IG9wZW5lZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XHJcbiAgY29uc3QgY3VycmVudFZhbGlkYXRvciA9IGdldEZvcm1WYWxpZGF0b3Iob3BlbmVkUG9wdXApO1xyXG4gIGN1cnJlbnRWYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVTYXZlQnV0dG9uKGlzU2F2aW5nLCBmb3JtU2VsZWN0b3IpIHtcclxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtU2VsZWN0b3IpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGZvcm0ucXVlcnlTZWxlY3RvcihcIi5zdWJtaXQtYnV0dG9uXCIpO1xyXG4gIGlmIChpc1NhdmluZykge1xyXG4gICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuICB9IGVsc2Uge1xyXG4gICAgaWYgKChmb3JtU2VsZWN0b3IgPSBcIi5kZWxldGUtcG9wdXBcIikpIHtcclxuICAgICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJZZXNcIjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5cclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vc2NyaXB0L3V0aWxzL0FwaS5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IHtcclxuICBlZGl0UHJvZmlsZUJ1dHRvbixcclxuICBlZGl0QXZhdGFyQnV0dG9uLFxyXG4gIGFkZENhcmRCdXR0b24sXHJcbiAgdXNlckRhdGFJbnB1dCxcclxuICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgZWxlbWVudHNDb250YWluZXIsXHJcbiAgdmFsaWRhdG9yc0xpc3QsXHJcbiAgZm9ybXNMaXN0LFxyXG4gIGNvbmZpZyxcclxufSBmcm9tIFwiLi4vc2NyaXB0L3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgeyByZXNldFZhbGlkYXRvciwgdXBkYXRlU2F2ZUJ1dHRvbiB9IGZyb20gXCIuLi9zY3JpcHQvdXRpbHMvdXRpbHMuanNcIjtcclxuXHJcbmZ1bmN0aW9uIGZpbGxQcm9maWxlRm9ybShjdXJyZW50SW5mbykge1xyXG4gIHVzZXJEYXRhSW5wdXQubmFtZS52YWx1ZSA9IGN1cnJlbnRJbmZvLm5hbWU7XHJcbiAgdXNlckRhdGFJbnB1dC5hYm91dC52YWx1ZSA9IGN1cnJlbnRJbmZvLmFib3V0O1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW5kZXJJbml0aWFsSW5mbygpIHtcclxuICBhcGlcclxuICAgIC5nZXRBbGxJbmZvKClcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0gZGF0YVswXTtcclxuICAgICAgY29uc3QgY2FyZHNEYXRhID0gZGF0YVsxXTtcclxuXHJcbiAgICAgIHVzZXJJbmZvLnNhdmVVc2VySWQodXNlckRhdGEuX2lkKTtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlckRhdGEpO1xyXG4gICAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHVzZXJEYXRhLmF2YXRhcik7XHJcblxyXG4gICAgICBjYXJkc0RhdGFcclxuICAgICAgICAuc2xpY2UoKVxyXG4gICAgICAgIC5yZXZlcnNlKClcclxuICAgICAgICAuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICAgICAgY2FyZHNTZWN0aW9uLnJlbmRlcmVyKGNhcmQsIHVzZXJEYXRhLl9pZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGFwaS5yZXBvcnRFcnJvcihlcnIpKTtcclxufVxyXG5cclxuLy9DbGFzc2VzIGluc3RhbmNlc1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCJmODAwYWY2Ni00YmNhLTQyZmQtODEzOS0xMTdkMTBiNWE1MTBcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oXHJcbiAgXCIjcHJvZmlsZS1uYW1lXCIsXHJcbiAgXCIjcHJvZmlsZS1hYm91dFwiLFxyXG4gIFwiI3Byb2ZpbGUtYXZhdGFyXCJcclxuKTtcclxuXHJcbmNvbnN0IGltYWdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIuaW1hZ2UtcG9wdXBcIik7XHJcblxyXG5jb25zdCBjcmVhdGVDYXJkID0gKGl0ZW0pID0+IHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICBpdGVtLFxyXG4gICAgZWxlbWVudFNlbGVjdG9yLFxyXG4gICAgdXNlckluZm8uZ2V0VXNlcklkKCksXHJcbiAgICAoZXZ0KSA9PiB7XHJcbiAgICAgIGltYWdlUG9wdXAub3BlbihldnQpO1xyXG4gICAgfSxcclxuICAgIChldnQpID0+IHtcclxuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBldnQuY3VycmVudFRhcmdldDtcclxuICAgICAgZGVsZXRlUG9wdXAub3BlbigpO1xyXG4gICAgICBkZWxldGVQb3B1cC5zZXRDb25maXJtSGFuZGxlcigoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZElkID0gY2FyZC5fY2FyZElkO1xyXG5cclxuICAgICAgICB1cGRhdGVTYXZlQnV0dG9uKHRydWUsIFwiLmRlbGV0ZS1wb3B1cFwiKTtcclxuXHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBkZWxldGVQb3B1cC5jbG9zZSgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBhcGkucmVwb3J0RXJyb3IoZXJyKSlcclxuICAgICAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgICAgdXBkYXRlU2F2ZUJ1dHRvbihmYWxzZSwgXCIuZGVsZXRlLXBvcHVwXCIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBkZWxldGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfSxcclxuICAgICgpID0+IHtcclxuICAgICAgaWYgKGNhcmQuaXNMaWtlZCgpKSB7XHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAuY2hhbmdlQ2FyZExpa2UoY2FyZC5fY2FyZElkLCBcIkRFTEVURVwiKVxyXG4gICAgICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XHJcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXModXBkYXRlZENhcmQubGlrZXMpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBhcGkucmVwb3J0RXJyb3IoZXJyKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAuY2hhbmdlQ2FyZExpa2UoY2FyZC5fY2FyZElkLCBcIlBVVFwiKVxyXG4gICAgICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XHJcbiAgICAgICAgICAgIGNhcmQudXBkYXRlTGlrZXModXBkYXRlZENhcmQubGlrZXMpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBhcGkucmVwb3J0RXJyb3IoZXJyKSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICApO1xyXG5cclxuICBjb25zdCBnZW5lcmF0ZWRDYXJkID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxuICByZXR1cm4gZ2VuZXJhdGVkQ2FyZDtcclxufTtcclxuXHJcbmNvbnN0IGNhcmRzU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxyXG4gIHtcclxuICAgIHJlbmRlcmVyOiBjcmVhdGVDYXJkLFxyXG4gIH0sXHJcbiAgXCIuZWxlbWVudHNfX2xpc3RcIlxyXG4pO1xyXG5cclxuY29uc3QgZWRpdFByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxyXG4gIFwiLmVkaXQtcG9wdXBcIixcclxuICAoZXZ0LCBpbnB1dFZhbHVlcykgPT4ge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB1cGRhdGVTYXZlQnV0dG9uKHRydWUsIFwiLmVkaXQtcG9wdXBcIik7XHJcblxyXG4gICAgYXBpXHJcbiAgICAgIC5lZGl0UHJvZmlsZUluZm8oaW5wdXRWYWx1ZXMpXHJcbiAgICAgIC50aGVuKCh1c2VyUGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJQYXJhbWV0ZXJzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGFwaS5yZXBvcnRFcnJvcihlcnIpKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgdXBkYXRlU2F2ZUJ1dHRvbihmYWxzZSwgXCIuZWRpdC1wb3B1cFwiKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgZWRpdFByb2ZpbGVQb3B1cC5jbG9zZSgpO1xyXG4gIH1cclxuKTtcclxuXHJcbmNvbnN0IGF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIuYXZhdGFyLXBvcHVwXCIsIChldnQsIGlucHV0VmFsdWUpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgdXBkYXRlU2F2ZUJ1dHRvbih0cnVlLCBcIi5hdmF0YXItcG9wdXBcIik7XHJcblxyXG4gIGFwaVxyXG4gICAgLmVkaXRQcm9maWxlUGljdHVyZShpbnB1dFZhbHVlKVxyXG4gICAgLnRoZW4oKHVzZXJQYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlclBhcmFtZXRlcnMuYXZhdGFyKTtcclxuICAgICAgYXZhdGFyUG9wdXAuY2xvc2UoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gYXBpLnJlcG9ydEVycm9yKGVycikpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHVwZGF0ZVNhdmVCdXR0b24oZmFsc2UsIFwiLmF2YXRhci1wb3B1cFwiKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmNvbnN0IGFkZENhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLmFkZC1wb3B1cFwiLCAoZXZ0LCBpbnB1dFZhbHVlcykgPT4ge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICB1cGRhdGVTYXZlQnV0dG9uKHRydWUsIFwiLmFkZC1wb3B1cFwiKTtcclxuXHJcbiAgYXBpXHJcbiAgICAuYWRkTmV3Q2FyZChpbnB1dFZhbHVlcylcclxuICAgIC50aGVuKChjYXJkKSA9PiB7XHJcbiAgICAgIGNhcmRzU2VjdGlvbi5yZW5kZXJlcihjYXJkLCB1c2VySW5mby5nZXRVc2VySWQoKSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGFwaS5yZXBvcnRFcnJvcihlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICB1cGRhdGVTYXZlQnV0dG9uKGZhbHNlLCBcIi5hZGQtcG9wdXBcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XHJcbn0pO1xyXG5cclxuY29uc3QgZGVsZXRlUG9wdXAgPSBuZXcgUG9wdXBXaXRoQ29uZmlybShcIi5kZWxldGUtcG9wdXBcIik7XHJcblxyXG4vLyBFVkVOVCBMSVNURU5FUlNcclxuLy8gRWRpdCBQcm9maWxlIGZvcm0gbGlzdGVuZXJzXHJcbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY29uc3QgdXNlckN1cnJlbnRJbmZvID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBmaWxsUHJvZmlsZUZvcm0odXNlckN1cnJlbnRJbmZvKTtcclxuXHJcbiAgZWRpdFByb2ZpbGVQb3B1cC5vcGVuKCk7XHJcbiAgcmVzZXRWYWxpZGF0b3IoKTtcclxufSk7XHJcbmVkaXRBdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhdmF0YXJQb3B1cC5vcGVuKCk7XHJcbiAgcmVzZXRWYWxpZGF0b3IoKTtcclxufSk7XHJcblxyXG4vLyBBZGQgQ2FyZCBmb3JtIGxpc3RlbmVyc1xyXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgYWRkQ2FyZFBvcHVwLm9wZW4oKTtcclxuICByZXNldFZhbGlkYXRvcigpO1xyXG59KTtcclxuXHJcbi8vIEluaXRpYWwgZnVuY3Rpb25zXHJcblxyXG5mb3Jtc0xpc3QuZm9yRWFjaCgoZm9ybSkgPT4ge1xyXG4gIGNvbnN0IGZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIGZvcm0pO1xyXG5cclxuICB2YWxpZGF0b3JzTGlzdC5wdXNoKHsgdmFsaWRhdG9yOiBmb3JtVmFsaWRhdG9yLCBpZDogZm9ybS5pZCB9KTtcclxuXHJcbiAgZm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbn0pO1xyXG5cclxucmVuZGVySW5pdGlhbEluZm8oKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XHJcbiAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcclxuICB9XHJcblxyXG4gIF92ZXJpZnlSZXNwb25zZShyZXMpIHtcclxuICAgIGlmIChyZXMub2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcclxuICB9XHJcblxyXG4gIHJlcG9ydEVycm9yKGVycikge1xyXG4gICAgY29uc29sZS5sb2coYFNvbWV0aGluZyB3ZW50IHdyb25nLCBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xyXG4gIH1cclxuXHJcbiAgX2xvZ0luZm8ocmVzKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWw6XCIpO1xyXG4gICAgY29uc29sZS5sb2cocmVzKTtcclxuICB9XHJcblxyXG4gIGdldEFsbEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5sb2FkQ2FyZHMoKV0pLnRoZW4oXHJcbiAgICAgICh2YWx1ZXMpID0+IHtcclxuICAgICAgICByZXR1cm4gdmFsdWVzO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fdmVyaWZ5UmVzcG9uc2UpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2FkQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fdmVyaWZ5UmVzcG9uc2UpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0UHJvZmlsZUluZm8odXNlck5ld0luZm8pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogdXNlck5ld0luZm8ubmFtZSxcclxuICAgICAgICBhYm91dDogdXNlck5ld0luZm8uYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fdmVyaWZ5UmVzcG9uc2UpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0UHJvZmlsZVBpY3R1cmUoYXZhdGFyVXJsKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBhdmF0YXI6IGF2YXRhclVybC5hdmF0YXIsXHJcbiAgICAgIH0pLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fdmVyaWZ5UmVzcG9uc2UpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGROZXdDYXJkKGNhcmROZXdJbmZvKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogY2FyZE5ld0luZm8udGl0bGUsXHJcbiAgICAgICAgbGluazogY2FyZE5ld0luZm8ubGluayxcclxuICAgICAgfSksXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl92ZXJpZnlSZXNwb25zZSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fb3B0aW9ucy5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fdmVyaWZ5UmVzcG9uc2UpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlQ2FyZExpa2UoY2FyZElkLCBtZXRob2QpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBtZXRob2QsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX3ZlcmlmeVJlc3BvbnNlKVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbG9nSW5mbyhyZXMpO1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgY29uc3RydWN0b3IodXNlck5hbWVTZWxlY3RvciwgdXNlckFib3V0U2VsZWN0b3IsIHVzZXJBdmF0YXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fdXNlck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJOYW1lU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fdXNlckFib3V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQWJvdXRTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl91c2VyQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQXZhdGFyU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICBjb25zdCB1c2VySW5mbyA9IHt9O1xyXG4gICAgdXNlckluZm8ubmFtZSA9IHRoaXMuX3VzZXJOYW1lLnRleHRDb250ZW50O1xyXG4gICAgdXNlckluZm8uYWJvdXQgPSB0aGlzLl91c2VyQWJvdXQudGV4dENvbnRlbnQ7XHJcbiAgICByZXR1cm4gdXNlckluZm87XHJcbiAgfVxyXG5cclxuICBzYXZlVXNlcklkKHVzZXJJZCkge1xyXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlcklkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3VzZXJJZDtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKG5ld1VzZXJQYXJhbWV0ZXJzKSB7XHJcbiAgICB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCA9IG5ld1VzZXJQYXJhbWV0ZXJzLm5hbWU7XHJcbiAgICB0aGlzLl91c2VyQWJvdXQudGV4dENvbnRlbnQgPSBuZXdVc2VyUGFyYW1ldGVycy5hYm91dDtcclxuICB9XHJcblxyXG4gIHNldFVzZXJBdmF0YXIobmV3VXNlckF2YXRhcikge1xyXG4gICAgdGhpcy5fdXNlckF2YXRhci5zcmMgPSBuZXdVc2VyQXZhdGFyO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtaW1hZ2VcIik7XHJcbiAgICB0aGlzLl9wb3B1cENhcHRpb24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLWNhcHRpb25cIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKGV2dCwgaXRlbSkge1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gICAgdGhpcy5fc2V0UG9wdXBDb250ZW50KGV2dCk7XHJcbiAgfVxyXG5cclxuICBfc2V0UG9wdXBDb250ZW50KGV2dCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRJbWFnZSA9IGV2dC5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBzZWxlY3RlZENhcHRpb24gPSBldnQuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIi5lbGVtZW50X19jYXB0aW9uLXRleHRcIlxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLl9wb3B1cEltYWdlLnNyYyA9IHNlbGVjdGVkSW1hZ2Uuc3JjO1xyXG4gICAgdGhpcy5fcG9wdXBJbWFnZS5hbHQgPSBgRW5sYXJnZWQgJHtzZWxlY3RlZEltYWdlLmFsdH1gO1xyXG4gICAgdGhpcy5fcG9wdXBDYXB0aW9uLnRleHRDb250ZW50ID0gc2VsZWN0ZWRDYXB0aW9uLnRleHRDb250ZW50O1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICByZW5kZXJlcihpdGVtKSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5fcmVuZGVyZXIoaXRlbSk7XHJcblxyXG4gICAgdGhpcy5hZGRJdGVtKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGNvbmZpcm1IYW5kbGVyKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnN1Ym1pdC1idXR0b25cIik7XHJcbiAgICAvLyB0aGlzLl9jb25maXJtSGFuZGxlciA9IGNvbmZpcm1IYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgc2V0Q29uZmlybUhhbmRsZXIoaGFuZGxlQ29uZmlybSkge1xyXG4gICAgdGhpcy5faGFuZGxlQ29uZmlybSA9IGhhbmRsZUNvbmZpcm07XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9jb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDb25maXJtKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNvbmZpcm0pO1xyXG4gIH1cclxuXHJcbiAgLy8gY29uZmlybURlbGV0ZShldnQpIHtcclxuICAvLyAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAvLyAgICAgdGhpcy5fY29uZmlybUhhbmRsZXIoZXZ0KTtcclxuICAvLyAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsInVzZXJJZCIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZVJlbW92ZUVsZW1lbnQiLCJoYW5kbGVMaWtlQ2xpY2siLCJ0aGlzIiwiX3RpdGxlIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9jYXJkSWQiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9vd25lciIsIm93bmVyIiwiX3VzZXJJZCIsIl9zZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlUmVtb3ZlRWxlbWVudCIsIl9oYW5kbGVMaWtlQ2xpY2siLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwicmVtb3ZlQnV0dG9uIiwiX2VsZW1lbnQiLCJlbGVtZW50SW1hZ2UiLCJsaWtlQnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsImlzTGlrZWQiLCJzb21lIiwibGlrZSIsIl9yZW5kZXJMaWtlcyIsImxpa2VDb3VudGVyIiwidGV4dENvbnRlbnQiLCJsZW5ndGgiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJfcmVuZGVyRGVsZXRlQnV0dG9uIiwidXBkYXRlTGlrZXMiLCJnZW5lcmF0ZUNhcmQiLCJlbGVtZW50Q2FwdGlvbiIsImVsZW1lbnRMaWtlcyIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJjb25maWciLCJmb3JtIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfYnV0dG9uRWxlbWVudCIsInJlc2V0VmFsaWRhdGlvbiIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImZvckVhY2giLCJpbnB1dCIsIl9oaWRlSW5wdXRFcnJvciIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0RWxlbWVudCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJpZCIsImVycm9yTWVzc2FnZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJfaXNGb3JtSW52YWxpZCIsImRpc2FibGVkIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwIiwiX2Nsb3NlQnV0dG9uIiwiY2xvc2UiLCJiaW5kIiwiX2hhbmRsZUNsaWNrQ2xvc2UiLCJfaGFuZGxlRXNjQ2xvc2UiLCJvcGVuIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJQb3B1cFdpdGhGb3JtIiwiZm9ybVN1Ym1pdEhhbmRsZXIiLCJzdXBlciIsImlucHV0VmFsdWVzIiwiX2dldElucHV0VmFsdWVzIiwiX2Zvcm1TdWJtaXRIYW5kbGVyIiwiX3BvcHVwRm9ybSIsIl9pbnB1dHNBcnJheSIsImlucHV0RGF0YSIsImlucHV0TmFtZSIsInNwbGl0IiwidmFsdWUiLCJfaGFuZGxlU3VibWl0IiwicmVzZXQiLCJlZGl0UHJvZmlsZUJ1dHRvbiIsInVzZXJEYXRhSW5wdXQiLCJhYm91dCIsImVkaXRBdmF0YXJCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwidmFsaWRhdG9yc0xpc3QiLCJmb3Jtc0xpc3QiLCJyZXNldFZhbGlkYXRvciIsImZvcm1Db250YWluZXIiLCJmb3JtSWQiLCJmaW5kIiwidmFsaWRhdG9yIiwiZ2V0Rm9ybVZhbGlkYXRvciIsInVwZGF0ZVNhdmVCdXR0b24iLCJpc1NhdmluZyIsImZvcm1TZWxlY3RvciIsInN1Ym1pdEJ1dHRvbiIsImFwaSIsIm9wdGlvbnMiLCJfb3B0aW9ucyIsIl92ZXJpZnlSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJlcnIiLCJyZXBvcnRFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJzdGF0dXMiLCJfbG9nSW5mbyIsImdldEFsbEluZm8iLCJhbGwiLCJnZXRVc2VySW5mbyIsImxvYWRDYXJkcyIsInRoZW4iLCJ2YWx1ZXMiLCJmZXRjaCIsImJhc2VVcmwiLCJoZWFkZXJzIiwiZWRpdFByb2ZpbGVJbmZvIiwidXNlck5ld0luZm8iLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRQcm9maWxlUGljdHVyZSIsImF2YXRhclVybCIsImF2YXRhciIsImFkZE5ld0NhcmQiLCJjYXJkTmV3SW5mbyIsInRpdGxlIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImNoYW5nZUNhcmRMaWtlIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJBYm91dFNlbGVjdG9yIiwidXNlckF2YXRhclNlbGVjdG9yIiwiX3VzZXJOYW1lIiwiX3VzZXJBYm91dCIsIl91c2VyQXZhdGFyIiwic2F2ZVVzZXJJZCIsImdldFVzZXJJZCIsInNldFVzZXJJbmZvIiwibmV3VXNlclBhcmFtZXRlcnMiLCJzZXRVc2VyQXZhdGFyIiwibmV3VXNlckF2YXRhciIsImltYWdlUG9wdXAiLCJfcG9wdXBJbWFnZSIsIl9wb3B1cENhcHRpb24iLCJpdGVtIiwiX3NldFBvcHVwQ29udGVudCIsInNlbGVjdGVkSW1hZ2UiLCJjdXJyZW50VGFyZ2V0Iiwic2VsZWN0ZWRDYXB0aW9uIiwiY2FyZHNTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJlbGVtZW50IiwiYWRkSXRlbSIsInByZXBlbmQiLCJjYXJkIiwiY2FyZEVsZW1lbnQiLCJkZWxldGVQb3B1cCIsInNldENvbmZpcm1IYW5kbGVyIiwiY2F0Y2giLCJmaW5hbGx5IiwidXBkYXRlZENhcmQiLCJlZGl0UHJvZmlsZVBvcHVwIiwidXNlclBhcmFtZXRlcnMiLCJhdmF0YXJQb3B1cCIsImlucHV0VmFsdWUiLCJhZGRDYXJkUG9wdXAiLCJjb25maXJtSGFuZGxlciIsIl9jb25maXJtQnV0dG9uIiwiaGFuZGxlQ29uZmlybSIsIl9oYW5kbGVDb25maXJtIiwiY3VycmVudEluZm8iLCJmb3JtVmFsaWRhdG9yIiwicHVzaCIsInVzZXJEYXRhIiwiY2FyZHNEYXRhIiwic2xpY2UiLCJyZXZlcnNlIl0sInNvdXJjZVJvb3QiOiIifQ==