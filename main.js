!function(){"use strict";class e{constructor(e,t,s,r,n,o){this._title=e.name,this._link=e.link,this._cardId=e._id,this._likes=e.likes,this._owner=e.owner,this._userId=s,this._selector=t,this._handleCardClick=r,this._handleRemoveElement=n,this._handleLikeClick=o}_getTemplate(){return document.querySelector("#element").content.querySelector(this._selector).cloneNode(!0)}_setEventListeners(){const e=this._element.querySelector(".element__remove-button"),t=this._element.querySelector(".element__image"),s=this._element.querySelector(".element__like-button");this._element.addEventListener("click",(r=>{switch(r.target){case e:this._handleRemoveElement(r);break;case t:this._handleCardClick(r);break;case s:this._handleLikeClick(r)}}))}isLiked(){return this._likes.some((e=>e._id===this._userId))}_renderLikes(){const e=this._element.querySelector(".element__like-counter"),t=this._element.querySelector(".element__like-button");e.textContent=this._likes.length,this.isLiked()?t.classList.add("element__like-button_active"):t.classList.remove("element__like-button_active")}_renderDeleteButton(){const e=this._element.querySelector(".element__remove-button");this._owner._id===this._userId&&e.classList.add("element__remove-button_owner")}updateLikes(e){this._likes=e,this._renderLikes()}generateCard(){this._element=this._getTemplate(),this._element._id=this._cardId,this._element.owner=this._owner;const e=this._element.querySelector(".element__image"),t=this._element.querySelector(".element__caption-text"),s=this._element.querySelector(".element__like-counter");return this._setEventListeners(),this._renderLikes(),this._renderDeleteButton(),t.textContent=this._title,e.src=this._link,e.alt="Photo of ".concat(this._title),s.textContent=this._likes.length,this._element}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}resetValidation(){this._toggleButtonState(this._inputList,this._buttonElement),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_showInputError(e,t){const s=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_toggleButtonState(e,t){this._isFormInvalid(e)?(t.classList.add(this._inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._inactiveButtonClass),t.disabled=!1)}_isFormInvalid(e){return e.some((e=>!e.validity.valid))}}class s{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".close-button"),this.close=this.close.bind(this),this._handleClickClose=this._handleClickClose.bind(this),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}setEventListeners(){this._closeButton.addEventListener("click",this.close),this._popup.addEventListener("mousedown",this._handleClickClose),document.addEventListener("keydown",this._handleEscClose)}removeEventListeners(){this._closeButton.removeEventListener("click",this.close),this._popup.removeEventListener("mousedown",this._handleClickClose),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleClickClose(e){e.target===this._popup&&this.close()}}class r extends s{constructor(e,t){var s,r;super(e),r=e=>{const t=this._getInputValues();this._formSubmitHandler(e,t)},(s="_handleSubmit")in this?Object.defineProperty(this,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[s]=r,this._formSubmitHandler=t,this._popupForm=this._popup.querySelector(".form"),this._inputsArray=this._popup.querySelectorAll(".form__input")}_getInputValues(){const e={};return this._inputsArray.forEach((t=>{const s=t.id.split("-");e[s[0]]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._handleSubmit)}removeEventListeners(){super.removeEventListeners(),this._popupForm.removeEventListener("submit",this._handleSubmit)}close(){this._popupForm.reset(),this.removeEventListeners(),super.close()}}const n=document.querySelector(".profile__edit-button"),o={name:document.querySelector("#name-input"),about:document.querySelector("#about-input")},i=document.querySelector(".profile__avatar-edit"),a=document.querySelector(".profile__add-button"),l=(document.querySelector(".elements__list"),[]),c=Array.from(document.querySelectorAll(".form")),h={inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"};function u(){(function(e){const t=document.querySelector(".popup_opened").querySelector(".form").id;return l.find((e=>e.id===t)).validator})().resetValidation()}function _(e,t){const s=document.querySelector(t).querySelector("#popup-submit");e?s.textContent="Saving...":(t=".delete-popup")?s.textContent="Yes":s.textContent="Save"}const d=new class{constructor(e){this._options=e}_verifyResponse(e){return e.ok?e.json():Promise.reject(err)}reportError(e){console.log("Something went wrong, Error: ".concat(e.status))}_logInfo(e){console.log("Request was successful:"),console.log(e)}getAllInfo(){return Promise.all([this.getUserInfo(),this.loadCards()]).then((e=>e))}getUserInfo(){return fetch("".concat(this._options.baseUrl,"/users/me"),{headers:this._options.headers}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}loadCards(){return fetch("".concat(this._options.baseUrl,"/cards"),{headers:this._options.headers}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}editProfileInfo(e){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}editProfilePicture(e){return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e.avatar})}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}addNewCard(e){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",headers:this._options.headers,body:JSON.stringify({name:e.title,link:e.link})}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}deleteCard(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._options.headers}).then(this._verifyResponse).then((e=>{this._logInfo(e)}))}changeCardLike(e,t){return fetch("".concat(this._options.baseUrl,"/cards/likes/").concat(e),{method:t,headers:this._options.headers}).then(this._verifyResponse).then((e=>(this._logInfo(e),e)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"f800af66-4bca-42fd-8139-117d10b5a510","Content-Type":"application/json"}}),p=new class{constructor(e,t,s){this._userName=document.querySelector(e),this._userAbout=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){const e={};return e.name=this._userName.textContent,e.about=this._userAbout.textContent,e}saveUserId(e){this._userId=e}getUserId(){return this._userId}setUserInfo(e){this._userName.textContent=e.name,this._userAbout.textContent=e.about}setUserAvatar(e){this._userAvatar.src=e}}("#profile-name","#profile-about","#profile-avatar"),m=new class extends s{constructor(e){super(e),this._popupImage=this._popup.querySelector("#popup-image"),this._popupCaption=this._popup.querySelector("#popup-caption")}open(e,t){super.open(),this._setPopupContent(e)}_setPopupContent(e){const t=e.currentTarget.querySelector(".element__image"),s=e.currentTarget.querySelector(".element__caption-text");this._popupImage.src=t.src,this._popupImage.alt="Enlarged ".concat(t.alt),this._popupCaption.textContent=s.textContent}}(".image-popup"),v=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderer(e){const t=this._renderer(e);this.addItem(t)}addItem(e){this._container.prepend(e)}}({renderer:t=>{const s=new e(t,".elements__list-item",p.getUserId(),(e=>{m.open(e)}),(e=>{const t=e.currentTarget;y.open(),y.setConfirmHandler((()=>{const e=s._cardId;_(!0,".delete-popup"),d.deleteCard(e).then((()=>{t.remove(),y.close()})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".delete-popup")}))})),y.setEventListeners()}),(()=>{s.isLiked()?d.changeCardLike(s._cardId,"DELETE").then((e=>{s.updateLikes(e.likes)})).catch((e=>d.reportError(e))):d.changeCardLike(s._cardId,"PUT").then((e=>{s.updateLikes(e.likes)})).catch((e=>d.reportError(e)))}));return s.generateCard()}},".elements__list"),f=new r(".edit-popup",((e,t)=>{e.preventDefault(),_(!0,".edit-popup"),d.editProfileInfo(t).then((e=>{p.setUserInfo(e)})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".edit-popup")})),f.close()})),E=new r(".avatar-popup",((e,t)=>{e.preventDefault(),_(!0,".avatar-popup"),d.editProfilePicture(t).then((e=>{p.setUserAvatar(e.avatar),E.close()})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".avatar-popup")}))})),C=new r(".add-popup",((e,t)=>{e.preventDefault(),_(!0,".add-popup"),d.addNewCard(t).then((e=>{v.renderer(e,p.getUserId())})).catch((e=>d.reportError(e))).finally((()=>{_(!1,".add-popup")})),C.close()})),y=new class extends s{constructor(e,t){super(e),this._confirmButton=this._popup.querySelector(".confirm-button")}setConfirmHandler(e){this._handleConfirm=e}setEventListeners(){super.setEventListeners(),this._confirmButton.addEventListener("click",this._handleConfirm)}removeEventListeners(){super.removeEventListeners(),this._confirmButton.removeEventListener("click",this._handleConfirm)}}(".delete-popup");n.addEventListener("click",(()=>{var e;e=p.getUserInfo(),o.name.value=e.name,o.about.value=e.about,f.open(),u()})),i.addEventListener("click",(()=>{E.open(),u()})),a.addEventListener("click",(()=>{C.open(),u()})),c.forEach((e=>{const s=new t(h,e);l.push({validator:s,id:e.id}),s.enableValidation()})),d.getAllInfo().then((e=>{const t=e[0],s=e[1];p.saveUserId(t._id),p.setUserInfo(t),p.setUserAvatar(t.avatar),s.slice().reverse().forEach((e=>{v.renderer(e,t._id)}))})).catch((e=>d.reportError(e)))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQVF5RyxFQUFZcE4sS0FDdkMrRyxFQUFjQyxNQUFNTCxNQUFReUcsRUFBWXBHLE1Bb0t4QzJGLEVBQWlCaEgsT0FDakIwQixPQUVGSixFQUFpQnpGLGlCQUFpQixTQUFTLEtBQ3pDcUwsRUFBWWxILE9BQ1owQixPQUlGSCxFQUFjMUYsaUJBQWlCLFNBQVMsS0FDdEN1TCxFQUFhcEgsT0FDYjBCLE9BS0ZELEVBQVVuRCxTQUFTbkIsSUFDakIsTUFBTXVLLEVBQWdCLElBQUl6SyxFQUFjQyxFQUFRQyxHQUVoRHFFLEVBQWVtRyxLQUFLLENBQUU3RixVQUFXNEYsRUFBZXhJLEdBQUkvQixFQUFLK0IsS0FFekR3SSxFQUFjakosc0JBckxkMkQsRUFDR2UsYUFDQUksTUFBTTFKLElBQ0wsTUFBTStOLEVBQVcvTixFQUFLLEdBQ2hCZ08sRUFBWWhPLEVBQUssR0FFdkIrSyxFQUFTTyxXQUFXeUMsRUFBU25OLEtBQzdCbUssRUFBU1MsWUFBWXVDLEdBQ3JCaEQsRUFBU1csY0FBY3FDLEVBQVN4RCxRQUVoQ3lELEVBQ0dDLFFBQ0FDLFVBQ0F6SixTQUFTbUksSUFDUlIsRUFBYUUsU0FBU00sRUFBTW1CLEVBQVNuTixXQUcxQ29NLE9BQU9oRSxHQUFRVCxFQUFJVSxZQUFZRCxLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvdXRpbHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHQvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0L2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBkYXRhLFxyXG4gICAgY2FyZFNlbGVjdG9yLFxyXG4gICAgdXNlcklkLFxyXG4gICAgaGFuZGxlQ2FyZENsaWNrLFxyXG4gICAgaGFuZGxlUmVtb3ZlRWxlbWVudCxcclxuICAgIGhhbmRsZUxpa2VDbGlja1xyXG4gICkge1xyXG4gICAgdGhpcy5fdGl0bGUgPSBkYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xyXG4gICAgdGhpcy5fY2FyZElkID0gZGF0YS5faWQ7XHJcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICB0aGlzLl9vd25lciA9IGRhdGEub3duZXI7XHJcblxyXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG5cclxuICAgIHRoaXMuX3NlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5faGFuZGxlUmVtb3ZlRWxlbWVudCA9IGhhbmRsZVJlbW92ZUVsZW1lbnQ7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sgPSBoYW5kbGVMaWtlQ2xpY2s7XHJcbiAgfVxyXG5cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNlbGVtZW50XCIpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fc2VsZWN0b3IpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRUZW1wbGF0ZTtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIGNvbnN0IHJlbW92ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19yZW1vdmUtYnV0dG9uXCIpO1xyXG4gICAgY29uc3QgZWxlbWVudEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2ltYWdlXCIpO1xyXG4gICAgY29uc3QgbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlLWJ1dHRvblwiKTtcclxuXHJcbiAgICB0aGlzLl9lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIHN3aXRjaCAoZXZ0LnRhcmdldCkge1xyXG4gICAgICAgIGNhc2UgcmVtb3ZlQnV0dG9uOlxyXG4gICAgICAgICAgdGhpcy5faGFuZGxlUmVtb3ZlRWxlbWVudChldnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBlbGVtZW50SW1hZ2U6XHJcbiAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soZXZ0KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgbGlrZUJ1dHRvbjpcclxuICAgICAgICAgIHRoaXMuX2hhbmRsZUxpa2VDbGljayhldnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaXNMaWtlZCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fdXNlcklkKTtcclxuICB9XHJcblxyXG4gIF9yZW5kZXJMaWtlcygpIHtcclxuICAgIGNvbnN0IGxpa2VDb3VudGVyID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2xpa2UtY291bnRlclwiKTtcclxuICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZS1idXR0b25cIik7XHJcblxyXG4gICAgbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcbiAgICBpZiAodGhpcy5pc0xpa2VkKCkpIHtcclxuICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3JlbmRlckRlbGV0ZUJ1dHRvbigpIHtcclxuICAgIGNvbnN0IHJlbW92ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19yZW1vdmUtYnV0dG9uXCIpO1xyXG5cclxuICAgIGlmICh0aGlzLl9vd25lci5faWQgPT09IHRoaXMuX3VzZXJJZCkge1xyXG4gICAgICByZW1vdmVCdXR0b24uY2xhc3NMaXN0LmFkZChcImVsZW1lbnRfX3JlbW92ZS1idXR0b25fb3duZXJcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGVMaWtlcyhsaWtlcykge1xyXG4gICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHJcbiAgICB0aGlzLl9lbGVtZW50Ll9pZCA9IHRoaXMuX2NhcmRJZDtcclxuICAgIHRoaXMuX2VsZW1lbnQub3duZXIgPSB0aGlzLl9vd25lcjtcclxuXHJcbiAgICBjb25zdCBlbGVtZW50SW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBlbGVtZW50Q2FwdGlvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIuZWxlbWVudF9fY2FwdGlvbi10ZXh0XCJcclxuICAgICk7XHJcbiAgICBjb25zdCBlbGVtZW50TGlrZXMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZS1jb3VudGVyXCIpO1xyXG5cclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xyXG4gICAgdGhpcy5fcmVuZGVyRGVsZXRlQnV0dG9uKCk7XHJcblxyXG4gICAgZWxlbWVudENhcHRpb24udGV4dENvbnRlbnQgPSB0aGlzLl90aXRsZTtcclxuICAgIGVsZW1lbnRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgZWxlbWVudEltYWdlLmFsdCA9IGBQaG90byBvZiAke3RoaXMuX3RpdGxlfWA7XHJcbiAgICBlbGVtZW50TGlrZXMudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgZm9ybSkge1xyXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IGNvbmZpZy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBjb25maWcuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IGNvbmZpZy5lcnJvckNsYXNzO1xyXG5cclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXHJcbiAgICApO1xyXG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRMaXN0LCB0aGlzLl9idXR0b25FbGVtZW50KTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKHRoaXMuX2lucHV0TGlzdCwgdGhpcy5fYnV0dG9uRWxlbWVudCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKGlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG5cclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuXHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSB7XHJcbiAgICBpZiAodGhpcy5faXNGb3JtSW52YWxpZChpbnB1dExpc3QpKSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pc0Zvcm1JbnZhbGlkKGlucHV0TGlzdCkge1xyXG4gICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Nsb3NlQnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5jbG9zZS1idXR0b25cIik7XHJcblxyXG4gICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX2hhbmRsZUNsaWNrQ2xvc2UgPSB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbGlja0Nsb3NlKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVDbGlja0Nsb3NlKGV2dCkge1xyXG4gICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX3BvcHVwKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGZvcm1TdWJtaXRIYW5kbGVyKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyID0gZm9ybVN1Ym1pdEhhbmRsZXI7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbiAgICB0aGlzLl9pbnB1dHNBcnJheSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybV9faW5wdXRcIik7XHJcbiAgfVxyXG5cclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dERhdGEgPSB7fTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dHNBcnJheS5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnB1dE5hbWUgPSBpbnB1dC5pZC5zcGxpdChcIi1cIik7XHJcbiAgICAgIGlucHV0RGF0YVtpbnB1dE5hbWVbMF1dID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gaW5wdXREYXRhO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZVN1Ym1pdCA9IChldnQpID0+IHtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0gdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcclxuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyKGV2dCwgaW5wdXRWYWx1ZXMpO1xyXG4gIH07XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuX2hhbmRsZVN1Ym1pdCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcclxuICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIEVkaXRQcm9maWxlIGZvcm0gY29uc3RzXHJcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcclxuXHJcbmNvbnN0IHVzZXJEYXRhSW5wdXQgPSB7XHJcbiAgbmFtZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuYW1lLWlucHV0XCIpLFxyXG4gIGFib3V0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Fib3V0LWlucHV0XCIpLFxyXG59O1xyXG5jb25zdCBlZGl0QXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItZWRpdFwiKTtcclxuXHJcbi8vIEFkZENhcmQgZm9ybSBjb25zdHNcclxuY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuY29uc3QgZWxlbWVudFNlbGVjdG9yID0gXCIuZWxlbWVudHNfX2xpc3QtaXRlbVwiO1xyXG5jb25zdCBlbGVtZW50c0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2xpc3RcIik7XHJcblxyXG4vLyBWYWxpZGF0b3IgY29uc3RzXHJcbmNvbnN0IHZhbGlkYXRvcnNMaXN0ID0gW107XHJcbmNvbnN0IGZvcm1zTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtXCIpKTtcclxuXHJcbi8vIEluaXRpYWwgZnVuY3Rpb24gY29uc3RzXHJcbmNvbnN0IGNvbmZpZyA9IHtcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5mb3JtX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5mb3JtX19zYXZlXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJmb3JtX19zYXZlX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcImZvcm1fX2lucHV0X2ludmFsaWRcIixcclxuICBlcnJvckNsYXNzOiBcImZvcm1fX2lucHV0LWVycm9yX2FjdGl2ZVwiLFxyXG59O1xyXG5cclxuZXhwb3J0IHtcclxuICBlZGl0UHJvZmlsZUJ1dHRvbixcclxuICBlZGl0QXZhdGFyQnV0dG9uLFxyXG4gIHVzZXJEYXRhSW5wdXQsXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgZWxlbWVudHNDb250YWluZXIsXHJcbiAgdmFsaWRhdG9yc0xpc3QsXHJcbiAgZm9ybXNMaXN0LFxyXG4gIGNvbmZpZyxcclxufTtcclxuIiwiaW1wb3J0IHsgdmFsaWRhdG9yc0xpc3QgfSBmcm9tIFwiLi9jb25zdGFudHMuanNcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtVmFsaWRhdG9yKGZvcm1Db250YWluZXIpIHtcclxuICBjb25zdCBmb3JtSWQgPSBmb3JtQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKS5pZDtcclxuICByZXR1cm4gdmFsaWRhdG9yc0xpc3QuZmluZCgodmFsaWQpID0+IHZhbGlkLmlkID09PSBmb3JtSWQpLnZhbGlkYXRvcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0VmFsaWRhdG9yKCkge1xyXG4gIGNvbnN0IG9wZW5lZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9vcGVuZWRcIik7XHJcbiAgY29uc3QgY3VycmVudFZhbGlkYXRvciA9IGdldEZvcm1WYWxpZGF0b3Iob3BlbmVkUG9wdXApO1xyXG4gIGN1cnJlbnRWYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVTYXZlQnV0dG9uKGlzU2F2aW5nLCBmb3JtU2VsZWN0b3IpIHtcclxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtU2VsZWN0b3IpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGZvcm0ucXVlcnlTZWxlY3RvcihcIiNwb3B1cC1zdWJtaXRcIik7XHJcbiAgaWYgKGlzU2F2aW5nKSB7XHJcbiAgICBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAoKGZvcm1TZWxlY3RvciA9IFwiLmRlbGV0ZS1wb3B1cFwiKSkge1xyXG4gICAgICBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlllc1wiO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9zY3JpcHQvdXRpbHMvQXBpLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vc2NyaXB0L2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm0gZnJvbSBcIi4uL3NjcmlwdC9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1cIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9zY3JpcHQvY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIGVkaXRQcm9maWxlQnV0dG9uLFxyXG4gIGVkaXRBdmF0YXJCdXR0b24sXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICB1c2VyRGF0YUlucHV0LFxyXG4gIGVsZW1lbnRTZWxlY3RvcixcclxuICBlbGVtZW50c0NvbnRhaW5lcixcclxuICB2YWxpZGF0b3JzTGlzdCxcclxuICBmb3Jtc0xpc3QsXHJcbiAgY29uZmlnLFxyXG59IGZyb20gXCIuLi9zY3JpcHQvdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCB7IHJlc2V0VmFsaWRhdG9yLCB1cGRhdGVTYXZlQnV0dG9uIH0gZnJvbSBcIi4uL3NjcmlwdC91dGlscy91dGlscy5qc1wiO1xyXG5cclxuZnVuY3Rpb24gZmlsbFByb2ZpbGVGb3JtKGN1cnJlbnRJbmZvKSB7XHJcbiAgdXNlckRhdGFJbnB1dC5uYW1lLnZhbHVlID0gY3VycmVudEluZm8ubmFtZTtcclxuICB1c2VyRGF0YUlucHV0LmFib3V0LnZhbHVlID0gY3VycmVudEluZm8uYWJvdXQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlckluaXRpYWxJbmZvKCkge1xyXG4gIGFwaVxyXG4gICAgLmdldEFsbEluZm8oKVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc3QgdXNlckRhdGEgPSBkYXRhWzBdO1xyXG4gICAgICBjb25zdCBjYXJkc0RhdGEgPSBkYXRhWzFdO1xyXG5cclxuICAgICAgdXNlckluZm8uc2F2ZVVzZXJJZCh1c2VyRGF0YS5faWQpO1xyXG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyRGF0YSk7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEuYXZhdGFyKTtcclxuXHJcbiAgICAgIGNhcmRzRGF0YVxyXG4gICAgICAgIC5zbGljZSgpXHJcbiAgICAgICAgLnJldmVyc2UoKVxyXG4gICAgICAgIC5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgICAgICBjYXJkc1NlY3Rpb24ucmVuZGVyZXIoY2FyZCwgdXNlckRhdGEuX2lkKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gYXBpLnJlcG9ydEVycm9yKGVycikpO1xyXG59XHJcblxyXG4vL0NsYXNzZXMgaW5zdGFuY2VzXHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvY29ob3J0LTMtZW5cIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImY4MDBhZjY2LTRiY2EtNDJmZC04MTM5LTExN2QxMGI1YTUxMFwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhcclxuICBcIiNwcm9maWxlLW5hbWVcIixcclxuICBcIiNwcm9maWxlLWFib3V0XCIsXHJcbiAgXCIjcHJvZmlsZS1hdmF0YXJcIlxyXG4pO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5pbWFnZS1wb3B1cFwiKTtcclxuXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoaXRlbSkgPT4ge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGl0ZW0sXHJcbiAgICBlbGVtZW50U2VsZWN0b3IsXHJcbiAgICB1c2VySW5mby5nZXRVc2VySWQoKSxcclxuICAgIChldnQpID0+IHtcclxuICAgICAgaW1hZ2VQb3B1cC5vcGVuKGV2dCk7XHJcbiAgICB9LFxyXG4gICAgKGV2dCkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGV2dC5jdXJyZW50VGFyZ2V0O1xyXG4gICAgICBkZWxldGVQb3B1cC5vcGVuKCk7XHJcbiAgICAgIGRlbGV0ZVBvcHVwLnNldENvbmZpcm1IYW5kbGVyKCgpID0+IHtcclxuICAgICAgICBjb25zdCBjYXJkSWQgPSBjYXJkLl9jYXJkSWQ7XHJcblxyXG4gICAgICAgIHVwZGF0ZVNhdmVCdXR0b24odHJ1ZSwgXCIuZGVsZXRlLXBvcHVwXCIpO1xyXG5cclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC5kZWxldGVDYXJkKGNhcmRJZClcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgY2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIGRlbGV0ZVBvcHVwLmNsb3NlKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IGFwaS5yZXBvcnRFcnJvcihlcnIpKVxyXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICB1cGRhdGVTYXZlQnV0dG9uKGZhbHNlLCBcIi5kZWxldGUtcG9wdXBcIik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIGRlbGV0ZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB9LFxyXG4gICAgKCkgPT4ge1xyXG4gICAgICBpZiAoY2FyZC5pc0xpa2VkKCkpIHtcclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC5jaGFuZ2VDYXJkTGlrZShjYXJkLl9jYXJkSWQsIFwiREVMRVRFXCIpXHJcbiAgICAgICAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcclxuICAgICAgICAgICAgY2FyZC51cGRhdGVMaWtlcyh1cGRhdGVkQ2FyZC5saWtlcyk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IGFwaS5yZXBvcnRFcnJvcihlcnIpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC5jaGFuZ2VDYXJkTGlrZShjYXJkLl9jYXJkSWQsIFwiUFVUXCIpXHJcbiAgICAgICAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcclxuICAgICAgICAgICAgY2FyZC51cGRhdGVMaWtlcyh1cGRhdGVkQ2FyZC5saWtlcyk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IGFwaS5yZXBvcnRFcnJvcihlcnIpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGdlbmVyYXRlZENhcmQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG4gIHJldHVybiBnZW5lcmF0ZWRDYXJkO1xyXG59O1xyXG5cclxuY29uc3QgY2FyZHNTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAge1xyXG4gICAgcmVuZGVyZXI6IGNyZWF0ZUNhcmQsXHJcbiAgfSxcclxuICBcIi5lbGVtZW50c19fbGlzdFwiXHJcbik7XHJcblxyXG5jb25zdCBlZGl0UHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIuZWRpdC1wb3B1cFwiLFxyXG4gIChldnQsIGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIHVwZGF0ZVNhdmVCdXR0b24odHJ1ZSwgXCIuZWRpdC1wb3B1cFwiKTtcclxuXHJcbiAgICBhcGlcclxuICAgICAgLmVkaXRQcm9maWxlSW5mbyhpbnB1dFZhbHVlcylcclxuICAgICAgLnRoZW4oKHVzZXJQYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlclBhcmFtZXRlcnMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gYXBpLnJlcG9ydEVycm9yKGVycikpXHJcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICB1cGRhdGVTYXZlQnV0dG9uKGZhbHNlLCBcIi5lZGl0LXBvcHVwXCIpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICBlZGl0UHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgfVxyXG4pO1xyXG5cclxuY29uc3QgYXZhdGFyUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5hdmF0YXItcG9wdXBcIiwgKGV2dCwgaW5wdXRWYWx1ZSkgPT4ge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICB1cGRhdGVTYXZlQnV0dG9uKHRydWUsIFwiLmF2YXRhci1wb3B1cFwiKTtcclxuXHJcbiAgYXBpXHJcbiAgICAuZWRpdFByb2ZpbGVQaWN0dXJlKGlucHV0VmFsdWUpXHJcbiAgICAudGhlbigodXNlclBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih1c2VyUGFyYW1ldGVycy5hdmF0YXIpO1xyXG4gICAgICBhdmF0YXJQb3B1cC5jbG9zZSgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBhcGkucmVwb3J0RXJyb3IoZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgdXBkYXRlU2F2ZUJ1dHRvbihmYWxzZSwgXCIuYXZhdGFyLXBvcHVwXCIpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuY29uc3QgYWRkQ2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIuYWRkLXBvcHVwXCIsIChldnQsIGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIHVwZGF0ZVNhdmVCdXR0b24odHJ1ZSwgXCIuYWRkLXBvcHVwXCIpO1xyXG5cclxuICBhcGlcclxuICAgIC5hZGROZXdDYXJkKGlucHV0VmFsdWVzKVxyXG4gICAgLnRoZW4oKGNhcmQpID0+IHtcclxuICAgICAgY2FyZHNTZWN0aW9uLnJlbmRlcmVyKGNhcmQsIHVzZXJJbmZvLmdldFVzZXJJZCgpKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gYXBpLnJlcG9ydEVycm9yKGVycikpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHVwZGF0ZVNhdmVCdXR0b24oZmFsc2UsIFwiLmFkZC1wb3B1cFwiKTtcclxuICAgIH0pO1xyXG5cclxuICBhZGRDYXJkUG9wdXAuY2xvc2UoKTtcclxufSk7XHJcblxyXG5jb25zdCBkZWxldGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtKFwiLmRlbGV0ZS1wb3B1cFwiKTtcclxuXHJcbi8vIEVWRU5UIExJU1RFTkVSU1xyXG4vLyBFZGl0IFByb2ZpbGUgZm9ybSBsaXN0ZW5lcnNcclxuZWRpdFByb2ZpbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjb25zdCB1c2VyQ3VycmVudEluZm8gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIGZpbGxQcm9maWxlRm9ybSh1c2VyQ3VycmVudEluZm8pO1xyXG5cclxuICBlZGl0UHJvZmlsZVBvcHVwLm9wZW4oKTtcclxuICByZXNldFZhbGlkYXRvcigpO1xyXG59KTtcclxuZWRpdEF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGF2YXRhclBvcHVwLm9wZW4oKTtcclxuICByZXNldFZhbGlkYXRvcigpO1xyXG59KTtcclxuXHJcbi8vIEFkZCBDYXJkIGZvcm0gbGlzdGVuZXJzXHJcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRDYXJkUG9wdXAub3BlbigpO1xyXG4gIHJlc2V0VmFsaWRhdG9yKCk7XHJcbn0pO1xyXG5cclxuLy8gSW5pdGlhbCBmdW5jdGlvbnNcclxuXHJcbmZvcm1zTGlzdC5mb3JFYWNoKChmb3JtKSA9PiB7XHJcbiAgY29uc3QgZm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZywgZm9ybSk7XHJcblxyXG4gIHZhbGlkYXRvcnNMaXN0LnB1c2goeyB2YWxpZGF0b3I6IGZvcm1WYWxpZGF0b3IsIGlkOiBmb3JtLmlkIH0pO1xyXG5cclxuICBmb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxufSk7XHJcblxyXG5yZW5kZXJJbml0aWFsSW5mbygpO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgX3ZlcmlmeVJlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xyXG4gIH1cclxuXHJcbiAgcmVwb3J0RXJyb3IoZXJyKSB7XHJcbiAgICBjb25zb2xlLmxvZyhgU29tZXRoaW5nIHdlbnQgd3JvbmcsIEVycm9yOiAke2Vyci5zdGF0dXN9YCk7XHJcbiAgfVxyXG5cclxuICBfbG9nSW5mbyhyZXMpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiUmVxdWVzdCB3YXMgc3VjY2Vzc2Z1bDpcIik7XHJcbiAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gIH1cclxuXHJcbiAgZ2V0QWxsSW5mbygpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmxvYWRDYXJkcygpXSkudGhlbihcclxuICAgICAgKHZhbHVlcykgPT4ge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZXM7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl92ZXJpZnlSZXNwb25zZSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvYWRDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl92ZXJpZnlSZXNwb25zZSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGVkaXRQcm9maWxlSW5mbyh1c2VyTmV3SW5mbykge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX29wdGlvbnMuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiB1c2VyTmV3SW5mby5uYW1lLFxyXG4gICAgICAgIGFib3V0OiB1c2VyTmV3SW5mby5hYm91dCxcclxuICAgICAgfSksXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl92ZXJpZnlSZXNwb25zZSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGVkaXRQcm9maWxlUGljdHVyZShhdmF0YXJVcmwpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogYXZhdGFyVXJsLmF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl92ZXJpZnlSZXNwb25zZSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZE5ld0NhcmQoY2FyZE5ld0luZm8pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiBjYXJkTmV3SW5mby50aXRsZSxcclxuICAgICAgICBsaW5rOiBjYXJkTmV3SW5mby5saW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX3ZlcmlmeVJlc3BvbnNlKVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbG9nSW5mbyhyZXMpO1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9vcHRpb25zLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXHJcbiAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl92ZXJpZnlSZXNwb25zZSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xvZ0luZm8ocmVzKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VDYXJkTGlrZShjYXJkSWQsIG1ldGhvZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX29wdGlvbnMuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IG1ldGhvZCxcclxuICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4odGhpcy5fdmVyaWZ5UmVzcG9uc2UpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICB0aGlzLl9sb2dJbmZvKHJlcyk7XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih1c2VyTmFtZVNlbGVjdG9yLCB1c2VyQWJvdXRTZWxlY3RvciwgdXNlckF2YXRhclNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl91c2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl91c2VyQWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJBYm91dFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX3VzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJBdmF0YXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIGNvbnN0IHVzZXJJbmZvID0ge307XHJcbiAgICB1c2VySW5mby5uYW1lID0gdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQ7XHJcbiAgICB1c2VySW5mby5hYm91dCA9IHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudDtcclxuICAgIHJldHVybiB1c2VySW5mbztcclxuICB9XHJcblxyXG4gIHNhdmVVc2VySWQodXNlcklkKSB7XHJcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fdXNlcklkO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8obmV3VXNlclBhcmFtZXRlcnMpIHtcclxuICAgIHRoaXMuX3VzZXJOYW1lLnRleHRDb250ZW50ID0gbmV3VXNlclBhcmFtZXRlcnMubmFtZTtcclxuICAgIHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudCA9IG5ld1VzZXJQYXJhbWV0ZXJzLmFib3V0O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckF2YXRhcihuZXdVc2VyQXZhdGFyKSB7XHJcbiAgICB0aGlzLl91c2VyQXZhdGFyLnNyYyA9IG5ld1VzZXJBdmF0YXI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9wb3B1cEltYWdlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIiNwb3B1cC1pbWFnZVwiKTtcclxuICAgIHRoaXMuX3BvcHVwQ2FwdGlvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtY2FwdGlvblwiKTtcclxuICB9XHJcblxyXG4gIG9wZW4oZXZ0LCBpdGVtKSB7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgICB0aGlzLl9zZXRQb3B1cENvbnRlbnQoZXZ0KTtcclxuICB9XHJcblxyXG4gIF9zZXRQb3B1cENvbnRlbnQoZXZ0KSB7XHJcbiAgICBjb25zdCBzZWxlY3RlZEltYWdlID0gZXZ0LmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19pbWFnZVwiKTtcclxuICAgIGNvbnN0IHNlbGVjdGVkQ2FwdGlvbiA9IGV2dC5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiLmVsZW1lbnRfX2NhcHRpb24tdGV4dFwiXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuX3BvcHVwSW1hZ2Uuc3JjID0gc2VsZWN0ZWRJbWFnZS5zcmM7XHJcbiAgICB0aGlzLl9wb3B1cEltYWdlLmFsdCA9IGBFbmxhcmdlZCAke3NlbGVjdGVkSW1hZ2UuYWx0fWA7XHJcbiAgICB0aGlzLl9wb3B1cENhcHRpb24udGV4dENvbnRlbnQgPSBzZWxlY3RlZENhcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIHJlbmRlcmVyKGl0ZW0pIHtcclxuICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuXHJcbiAgICB0aGlzLmFkZEl0ZW0oZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgY29uZmlybUhhbmRsZXIpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fY29uZmlybUJ1dHRvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIuY29uZmlybS1idXR0b25cIik7XHJcbiAgICAvLyB0aGlzLl9jb25maXJtSGFuZGxlciA9IGNvbmZpcm1IYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgc2V0Q29uZmlybUhhbmRsZXIoaGFuZGxlQ29uZmlybSkge1xyXG4gICAgdGhpcy5faGFuZGxlQ29uZmlybSA9IGhhbmRsZUNvbmZpcm07XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9jb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDb25maXJtKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNvbmZpcm0pO1xyXG4gIH1cclxuXHJcbiAgLy8gY29uZmlybURlbGV0ZShldnQpIHtcclxuICAvLyAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAvLyAgICAgdGhpcy5fY29uZmlybUhhbmRsZXIoZXZ0KTtcclxuICAvLyAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsInVzZXJJZCIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZVJlbW92ZUVsZW1lbnQiLCJoYW5kbGVMaWtlQ2xpY2siLCJ0aGlzIiwiX3RpdGxlIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9jYXJkSWQiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9vd25lciIsIm93bmVyIiwiX3VzZXJJZCIsIl9zZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlUmVtb3ZlRWxlbWVudCIsIl9oYW5kbGVMaWtlQ2xpY2siLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwicmVtb3ZlQnV0dG9uIiwiX2VsZW1lbnQiLCJlbGVtZW50SW1hZ2UiLCJsaWtlQnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsImlzTGlrZWQiLCJzb21lIiwibGlrZSIsIl9yZW5kZXJMaWtlcyIsImxpa2VDb3VudGVyIiwidGV4dENvbnRlbnQiLCJsZW5ndGgiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJfcmVuZGVyRGVsZXRlQnV0dG9uIiwidXBkYXRlTGlrZXMiLCJnZW5lcmF0ZUNhcmQiLCJlbGVtZW50Q2FwdGlvbiIsImVsZW1lbnRMaWtlcyIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJjb25maWciLCJmb3JtIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfYnV0dG9uRWxlbWVudCIsInJlc2V0VmFsaWRhdGlvbiIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImZvckVhY2giLCJpbnB1dCIsIl9oaWRlSW5wdXRFcnJvciIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0RWxlbWVudCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJpZCIsImVycm9yTWVzc2FnZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJfaXNGb3JtSW52YWxpZCIsImRpc2FibGVkIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwIiwiX2Nsb3NlQnV0dG9uIiwiY2xvc2UiLCJiaW5kIiwiX2hhbmRsZUNsaWNrQ2xvc2UiLCJfaGFuZGxlRXNjQ2xvc2UiLCJvcGVuIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJQb3B1cFdpdGhGb3JtIiwiZm9ybVN1Ym1pdEhhbmRsZXIiLCJzdXBlciIsImlucHV0VmFsdWVzIiwiX2dldElucHV0VmFsdWVzIiwiX2Zvcm1TdWJtaXRIYW5kbGVyIiwiX3BvcHVwRm9ybSIsIl9pbnB1dHNBcnJheSIsImlucHV0RGF0YSIsImlucHV0TmFtZSIsInNwbGl0IiwidmFsdWUiLCJfaGFuZGxlU3VibWl0IiwicmVzZXQiLCJlZGl0UHJvZmlsZUJ1dHRvbiIsInVzZXJEYXRhSW5wdXQiLCJhYm91dCIsImVkaXRBdmF0YXJCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwidmFsaWRhdG9yc0xpc3QiLCJmb3Jtc0xpc3QiLCJyZXNldFZhbGlkYXRvciIsImZvcm1Db250YWluZXIiLCJmb3JtSWQiLCJmaW5kIiwidmFsaWRhdG9yIiwiZ2V0Rm9ybVZhbGlkYXRvciIsInVwZGF0ZVNhdmVCdXR0b24iLCJpc1NhdmluZyIsImZvcm1TZWxlY3RvciIsInN1Ym1pdEJ1dHRvbiIsImFwaSIsIm9wdGlvbnMiLCJfb3B0aW9ucyIsIl92ZXJpZnlSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJlcnIiLCJyZXBvcnRFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJzdGF0dXMiLCJfbG9nSW5mbyIsImdldEFsbEluZm8iLCJhbGwiLCJnZXRVc2VySW5mbyIsImxvYWRDYXJkcyIsInRoZW4iLCJ2YWx1ZXMiLCJmZXRjaCIsImJhc2VVcmwiLCJoZWFkZXJzIiwiZWRpdFByb2ZpbGVJbmZvIiwidXNlck5ld0luZm8iLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRQcm9maWxlUGljdHVyZSIsImF2YXRhclVybCIsImF2YXRhciIsImFkZE5ld0NhcmQiLCJjYXJkTmV3SW5mbyIsInRpdGxlIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImNoYW5nZUNhcmRMaWtlIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJBYm91dFNlbGVjdG9yIiwidXNlckF2YXRhclNlbGVjdG9yIiwiX3VzZXJOYW1lIiwiX3VzZXJBYm91dCIsIl91c2VyQXZhdGFyIiwic2F2ZVVzZXJJZCIsImdldFVzZXJJZCIsInNldFVzZXJJbmZvIiwibmV3VXNlclBhcmFtZXRlcnMiLCJzZXRVc2VyQXZhdGFyIiwibmV3VXNlckF2YXRhciIsImltYWdlUG9wdXAiLCJfcG9wdXBJbWFnZSIsIl9wb3B1cENhcHRpb24iLCJpdGVtIiwiX3NldFBvcHVwQ29udGVudCIsInNlbGVjdGVkSW1hZ2UiLCJjdXJyZW50VGFyZ2V0Iiwic2VsZWN0ZWRDYXB0aW9uIiwiY2FyZHNTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJlbGVtZW50IiwiYWRkSXRlbSIsInByZXBlbmQiLCJjYXJkIiwiY2FyZEVsZW1lbnQiLCJkZWxldGVQb3B1cCIsInNldENvbmZpcm1IYW5kbGVyIiwiY2F0Y2giLCJmaW5hbGx5IiwidXBkYXRlZENhcmQiLCJlZGl0UHJvZmlsZVBvcHVwIiwidXNlclBhcmFtZXRlcnMiLCJhdmF0YXJQb3B1cCIsImlucHV0VmFsdWUiLCJhZGRDYXJkUG9wdXAiLCJjb25maXJtSGFuZGxlciIsIl9jb25maXJtQnV0dG9uIiwiaGFuZGxlQ29uZmlybSIsIl9oYW5kbGVDb25maXJtIiwiY3VycmVudEluZm8iLCJmb3JtVmFsaWRhdG9yIiwicHVzaCIsInVzZXJEYXRhIiwiY2FyZHNEYXRhIiwic2xpY2UiLCJyZXZlcnNlIl0sInNvdXJjZVJvb3QiOiIifQ==